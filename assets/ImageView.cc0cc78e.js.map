{"version":3,"file":"ImageView.cc0cc78e.js","sources":["../../src/plugins/image/ImageView.vue","../../src/plugins/image/ImageView.vue?vue&type=template&lang.js"],"sourcesContent":["<template lang=\"pug\">\r\n.image-container(v-if=\"myState.yamlConfig\" :class=\"{'zthumbnail' : thumbnail }\")\r\n  img.medium-zoom(\r\n    :src=\"myState.imageData\"\r\n    :class=\"{'invert-colors' : isDarkMode }\")\r\n</template>\r\n\r\n<script lang=\"ts\">\r\n'use strict'\r\n\r\nimport { defineComponent } from 'vue'\r\nimport type { PropType } from 'vue'\r\n\r\n// import mediumZoom from 'medium-zoom'\r\nimport readBlob from 'read-blob'\r\n\r\nimport globalStore from '@/store'\r\nimport { ColorScheme, FileSystem, FileSystemConfig, VisualizationPlugin } from '@/Globals'\r\nimport HTTPFileSystem from '@/js/HTTPFileSystem'\r\n\r\nconst MyComponent = defineComponent({\r\n  name: 'ImageViewPlugin',\r\n  props: {\r\n    fileApi: { type: Object as PropType<FileSystem>, required: true },\r\n    subfolder: { type: String, required: true },\r\n    yamlConfig: String,\r\n    thumbnail: Boolean,\r\n  },\r\n  data: () => {\r\n    return {\r\n      globalState: globalStore.state,\r\n      myState: {} as any,\r\n      matsimPngTitles: {\r\n        'modestats.png': 'Mode statistics',\r\n        'ph_modestats.png': 'Passenger hours traveled per mode',\r\n        'pkm_modestats.png': 'Passenger km traveled per mode',\r\n        'scorestats.png': 'Score statistics',\r\n        'stopwatch.png': 'Stopwatch: computation time',\r\n        'traveldistancestatslegs.png': 'Leg travel distance',\r\n        'traveldistancestatstrips.png': 'Trip travel distance',\r\n      } as { [id: string]: string },\r\n    }\r\n  },\r\n  computed: {\r\n    isDarkMode(): boolean {\r\n      return this.globalState.isDarkMode\r\n    },\r\n  },\r\n  methods: {\r\n    // this happens if viz is the full page, not a thumbnail on a project page\r\n    buildRouteFromUrl() {\r\n      const params = this.$route.params\r\n      if (!params.project || !params.pathMatch) {\r\n        console.log('I CANT EVEN: NO PROJECT/PARHMATCH')\r\n        return\r\n      }\r\n\r\n      // subfolder and config file\r\n      const sep = 1 + params.pathMatch.lastIndexOf('/')\r\n      const subfolder = params.pathMatch.substring(0, sep)\r\n      const config = params.pathMatch.substring(sep)\r\n\r\n      this.myState.subfolder = subfolder\r\n      this.myState.yamlConfig = config\r\n    },\r\n\r\n    async getVizDetails() {\r\n      try {\r\n        const blob = await this.myState.fileApi.getFileBlob(\r\n          this.myState.subfolder + '/' + this.myState.yamlConfig\r\n        )\r\n\r\n        if (!blob) {\r\n          console.log('no blob! :-(')\r\n          return\r\n        }\r\n\r\n        const dataUrl = await readBlob.dataurl(blob)\r\n        this.myState.imageData = dataUrl\r\n\r\n        const config = this.yamlConfig as any\r\n        const newTitle = this.matsimPngTitles[config]\r\n          ? this.matsimPngTitles[config]\r\n          : this.yamlConfig\r\n\r\n        this.$emit('title', newTitle)\r\n      } catch (e) {\r\n        console.error({ e })\r\n        return null\r\n      }\r\n    },\r\n  },\r\n  watch: {\r\n    yamlConfig() {\r\n      this.myState.yamlConfig = this.yamlConfig\r\n      this.getVizDetails()\r\n    },\r\n\r\n    subfolder() {\r\n      this.myState.subfolder = this.subfolder\r\n      this.getVizDetails()\r\n    },\r\n  },\r\n  mounted() {\r\n    this.myState = {\r\n      fileApi: this.fileApi,\r\n      subfolder: this.subfolder,\r\n      yamlConfig: this.yamlConfig,\r\n      thumbnail: this.thumbnail,\r\n      imageData: '',\r\n    }\r\n\r\n    if (!this.yamlConfig) {\r\n      this.buildRouteFromUrl()\r\n    }\r\n\r\n    this.getVizDetails()\r\n  },\r\n})\r\n\r\nexport default MyComponent\r\n</script>\r\n\r\n<style scoped lang=\"scss\">\r\n@import '@/styles.scss';\r\n\r\n.image-container.zthumbnail {\r\n  max-height: $thumbnailHeight;\r\n  overflow: hidden;\r\n}\r\n\r\n.medium-zoom {\r\n  padding: 0.25rem 0.25rem;\r\n}\r\n\r\n// .invert-colors {\r\n//   filter: invert(100%);\r\n// }\r\n</style>\r\n","\r\n.image-container(v-if=\"myState.yamlConfig\" :class=\"{'zthumbnail' : thumbnail }\")\r\n  img.medium-zoom(\r\n    :src=\"myState.imageData\"\r\n    :class=\"{'invert-colors' : isDarkMode }\")\r\n"],"names":["MyComponent","defineComponent","globalStore","params","sep","subfolder","config","blob","dataUrl","readBlob","newTitle","e","render","_vm","_h","_c","staticRenderFns"],"mappings":"8FAoBA,MAAAA,EAAAC,EAAA,CACA,KAAA,kBACA,MAAA,CACA,QAAA,CAAA,KAAA,OAAA,SAAA,EAAA,EACA,UAAA,CAAA,KAAA,OAAA,SAAA,EAAA,EACA,WAAA,OACA,UAAA,OACA,EACA,KAAA,KACA,CACA,YAAAC,EAAA,MACA,QAAA,CAAA,EACA,gBAAA,CACA,gBAAA,kBACA,mBAAA,oCACA,oBAAA,iCACA,iBAAA,mBACA,gBAAA,8BACA,8BAAA,sBACA,+BAAA,sBACA,CAAA,GAGA,SAAA,CACA,YAAA,CACA,OAAA,KAAA,YAAA,UACA,CACA,EACA,QAAA,CAEA,mBAAA,CACA,MAAAC,EAAA,KAAA,OAAA,OACA,GAAA,CAAAA,EAAA,SAAA,CAAAA,EAAA,UAAA,CACA,QAAA,IAAA,mCAAA,EACA,MACA,CAGA,MAAAC,EAAA,EAAAD,EAAA,UAAA,YAAA,GAAA,EACAE,EAAAF,EAAA,UAAA,UAAA,EAAAC,CAAA,EACAE,EAAAH,EAAA,UAAA,UAAAC,CAAA,EAEA,KAAA,QAAA,UAAAC,EACA,KAAA,QAAA,WAAAC,CACA,EAEA,MAAA,eAAA,CACA,GAAA,CACA,MAAAC,EAAA,MAAA,KAAA,QAAA,QAAA,YACA,KAAA,QAAA,UAAA,IAAA,KAAA,QAAA,UAAA,EAGA,GAAA,CAAAA,EAAA,CACA,QAAA,IAAA,cAAA,EACA,MACA,CAEA,MAAAC,EAAA,MAAAC,EAAA,QAAAF,CAAA,EACA,KAAA,QAAA,UAAAC,EAEA,MAAAF,EAAA,KAAA,WACAI,EAAA,KAAA,gBAAAJ,GACA,KAAA,gBAAAA,GACA,KAAA,WAEA,KAAA,MAAA,QAAAI,CAAA,QACAC,GACA,eAAA,MAAA,CAAA,EAAAA,CAAA,CAAA,EACA,IACA,CACA,CACA,EACA,MAAA,CACA,YAAA,CACA,KAAA,QAAA,WAAA,KAAA,WACA,KAAA,cAAA,CACA,EAEA,WAAA,CACA,KAAA,QAAA,UAAA,KAAA,UACA,KAAA,cAAA,CACA,CACA,EACA,SAAA,CACA,KAAA,QAAA,CACA,QAAA,KAAA,QACA,UAAA,KAAA,UACA,WAAA,KAAA,WACA,UAAA,KAAA,UACA,UAAA,EAAA,EAGA,KAAA,YACA,KAAA,kBAAA,EAGA,KAAA,cAAA,CACA,CACA,CAAA,ECtHA,IAAIC,EAAS,UAAY,CACvB,IAAIC,EAAI,KACJC,EAAGD,EAAI,eACPE,EAAGF,EAAI,MAAM,IAAIC,EAErB,OAAOD,EAAI,QAAQ,WAAaE,EAAG,MAAO,CACxC,YAAa,kBACb,MAAO,CACL,WAAcF,EAAI,SACnB,CACL,EAAK,CAACE,EAAG,MAAO,CACZ,YAAa,cACb,MAAO,CACL,gBAAiBF,EAAI,UACtB,EACD,MAAO,CACL,IAAOA,EAAI,QAAQ,SACpB,CACF,CAAA,CAAC,CAAC,EAAIA,EAAI,IACb,EACIG,EAAkB,CAAE"}