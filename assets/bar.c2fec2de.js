import{d as f,g as p,U as y,S as c,B as u,n as b}from"./index.1d7144b8.js";import{V as x}from"./VuePlotly.a136978d.js";import{b as v}from"./DashBoard.c40bb82f.js";import"./index.d10190c4.js";import"./HTTPFileSystem.33aea9ff.js";import"./TopSheet.f44901df.js";var S=f({name:"BarChartPanel",components:{VuePlotly:x},props:{fileSystemConfig:{type:Object,required:!0},subfolder:{type:String,required:!0},files:{type:Array,required:!0},config:{type:Object,required:!0},cardTitle:{type:String,required:!0},cardId:String,datamanager:Object},data:()=>({globalState:p.state,id:"bar-"+Math.floor(1e12*Math.random()),plotID:Math.floor(1e12*Math.random()).toString(),className:"",dataSet:{},YAMLrequirementsBar:{dataset:"",x:"",columns:""},layout:{barmode:"overlay",bargap:.08,height:300,margin:{t:8,b:0,l:0,r:0,pad:2},font:{color:"#444444",family:y},xaxis:{automargin:!0,autorange:!0,title:{text:"",standoff:12},animate:!0},yaxis:{automargin:!0,autorange:!0,title:{text:"",standoff:16},animate:!0},legend:{orientation:"v",x:1,y:1}},data:[],options:{responsive:!0,displaylogo:!1,modeBarButtonsToRemove:["pan2d","zoom2d","select2d","lasso2d","zoomIn2d","zoomOut2d","autoScale2d","hoverClosestCartesian","hoverCompareCartesian","resetScale2d","toggleSpikelines","resetViewMapbox"],toImageButtonOptions:{format:"png",filename:"bar-chart",width:null,height:null}}}),async mounted(){this.updateLayout(),this.updateTheme(),this.dataSet=await this.loadData(),this.updateChart(),this.options.toImageButtonOptions.filename=v(this.cardTitle,this.subfolder),this.$emit("dimension-resizer",{id:this.cardId,resizer:this.changeDimensions}),this.$emit("isLoaded"),this.checkWarningsAndErrors()},beforeDestroy(){var t;(t=this.datamanager)==null||t.removeFilterListener(this.config,this.handleFilterChanged)},watch:{"globalState.isDarkMode"(){this.updateTheme()}},methods:{changeDimensions(t){this.layout=Object.assign({},this.layout,t)},checkWarningsAndErrors(){var t=this.cardTitle;t.length==0&&this.$store.commit("setStatus",{type:c.WARNING,msg:"The plot title is missing!",desc:"Please add a plot title in the .yaml-file (title: 'Example title')"})},updateTheme(){const t={paper_bgcolor:u[this.globalState.colorScheme],plot_bgcolor:u[this.globalState.colorScheme],font:{color:this.globalState.isDarkMode?"#cccccc":"#444444"}};this.layout=Object.assign({},this.layout,t)},updateLayout(){this.layout.xaxis.title.text=this.config.xAxisTitle||this.config.xAxisName||"",this.layout.yaxis.title.text=this.config.yAxisTitle||this.config.yAxisName||""},async handlePlotlyClick(t){try{const{x:e,y:a,data:i}=t.points[0],s=this.config.groupBy,r=e}catch(e){console.error(e)}},async handleFilterChanged(){if(!!this.datamanager)try{const{filteredRows:t}=this.datamanager.getFilteredDataset(this.config);if(!t){this.data=[this.data[0]],this.data[0].opacity=1;return}const e=Object.assign({},this.data[0]);e.x=t.x,e.y=t.y,e.opacity=1,e.name="Filtered",e.marker={color:"#ffaf00"},this.data=[this.data[0],e],this.data[0].opacity=.3,this.data[0].name="All"}catch(t){const e=""+t;console.log(e),this.dataSet={}}},async loadData(){if(!this.datamanager)return{};try{this.validateYAML();let t=await this.datamanager.getDataset(this.config);if(!this.config.filters)return t;this.datamanager.addFilterListener(this.config,this.handleFilterChanged);for(const[e,a]of Object.entries(this.config.filters)){const i={dataset:this.config.dataset,column:e,value:a,range:Array.isArray(a)};this.datamanager.setFilter(i)}return{allRows:{}}}catch(t){console.error(""+t)}return{allRows:{}}},validateYAML(){console.log("in bars validation");for(const t in this.YAMLrequirementsBar)t in this.config||this.$store.commit("setStatus",{type:c.ERROR,msg:`YAML file missing required key: ${t}`,desc:"Check this.YAMLrequirementsXY for required keys"})},updateChart(){try{this.config.groupBy?this.updateChartWithGroupBy():this.updateChartSimple()}catch(t){const e=""+t;this.$store.commit("setStatus",{type:c.ERROR,msg:e})}},updateChartWithGroupBy(){this.className=this.plotID},updateChartSimple(){var h,d;let t=[];var e=!1;const a=this.dataSet.allRows||{},i=Object.keys(a);if(!i.length)return;let s=this.config.columns||this.config.usedCol;!s&&i.length&&(s=i.filter(o=>o!==this.config.x).sort()),this.config.legendName&&(this.config.legendTitles=this.config.legendName),(h=this.config.legendTitles)!=null&&h.length&&(e=!0),this.config.stacked?this.layout.barmode="stack":this.layout.barmode="group",this.config.stacked&&(this.className=this.plotID);const r=a[this.config.x];if(!r)throw Error(`File ${this.config.dataset}: Could not find column ${this.config.x}`);t=r.values,this.config.skipFirstRow&&(t=t.slice(1));for(let o=0;o<s.length;o++){const l=s[o],m=e&&(d=this.config.legendTitles[o])!=null?d:l;let n=a[l].values;this.config.skipFirstRow&&(n=n.slice(1)),this.config.convertToSeconds&&(n=this.convertToSeconds(n)),this.data.push({x:t,y:n,name:m,type:"bar",textinfo:"label+percent",textposition:"inside",automargin:!0,opacity:1})}},convertToSeconds(t){t=t.map(e=>{try{return e.split(":").reduce((s,r)=>parseInt(r,10)+s*60,0)}catch{return 0}})}}}),_=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("VuePlotly",{staticClass:"myplot",class:t.className,attrs:{data:t.data,layout:t.layout,options:t.options,id:t.id}})},C=[];const g={};var A=b(S,_,C,!1,T,"6d146ae7",null,null);function T(t){for(let e in g)this[e]=g[e]}var M=function(){return A.exports}();export{M as default};
//# sourceMappingURL=bar.c2fec2de.js.map
