import{r as se,h as w,g as z,R as N,M as oe,d as ae,C as re,S as _,n as le}from"./index.1d7144b8.js";import{V as ce}from"./vue-slider-component.umd.min.c2de2844.js";import{d as ue}from"./index.86d5d5c9.js";import{b as U}from"./index.d10190c4.js";import{u as ge}from"./util.5fe75924.js";import{H as de}from"./HTTPFileSystem.33aea9ff.js";import{C as he}from"./CollapsiblePanel.c7402232.js";import{m as me,W as fe,p as pe,g as ve,D as ye}from"./DrawingTool.dcd0790f.js";import{Z as Se}from"./ZoomButtons.6b3cc4d8.js";import{D as xe,S as be}from"./deckgl.8395df4c.js";import{G as Ce,ae as De,l as k,a as we,a1 as _e,af as Ae,$ as Me,b as ze,c as Pe,M as Le,U as $,_ as x,ag as Ie,ah as Te,ai as Fe,Y as ke}from"./layer.0cd20467.js";import{c as Ee}from"./index.7080a99e.js";import{A as Re}from"./arc-layer.c708f4b2.js";import{C as He}from"./text-layer.c8c59efd.js";import"./path-layer.4a6bc071.js";import"./extends.946277fc.js";class Ve extends Ce{constructor(e){const{id:i=De("column-geometry")}=e,{indices:n,attributes:s}=Oe(e);super({...e,id:i,indices:n,attributes:s})}}function Oe(t){const{radius:e,height:i=1,nradial:n=10}=t;let{vertices:s}=t;s&&(k.assert(s.length>=n),s=s.flatMap(h=>[h[0],h[1]]),me(s,fe.COUNTER_CLOCKWISE));const o=i>0,a=n+1,r=o?a*3+1:n,u=Math.PI*2/n,l=new Uint16Array(o?n*3*2:0),d=new Float32Array(r*3),c=new Float32Array(r*3);let g=0;if(o){for(let h=0;h<a;h++){const p=h*u,f=h%n,v=Math.sin(p),y=Math.cos(p);for(let S=0;S<2;S++)d[g+0]=s?s[f*2]:y*e,d[g+1]=s?s[f*2+1]:v*e,d[g+2]=(1/2-S)*i,c[g+0]=s?s[f*2]:y,c[g+1]=s?s[f*2+1]:v,g+=3}d[g+0]=d[g-3],d[g+1]=d[g-2],d[g+2]=d[g-1],g+=3}for(let h=o?0:1;h<a;h++){const p=Math.floor(h/2)*Math.sign(.5-h%2),f=p*u,v=(p+n)%n,y=Math.sin(f),S=Math.cos(f);d[g+0]=s?s[v*2]:S*e,d[g+1]=s?s[v*2+1]:y*e,d[g+2]=i/2,c[g+2]=1,g+=3}if(o){let h=0;for(let p=0;p<n;p++)l[h++]=p*2+0,l[h++]=p*2+2,l[h++]=p*2+0,l[h++]=p*2+1,l[h++]=p*2+1,l[h++]=p*2+3}return{indices:l,attributes:{POSITION:{size:3,value:d},NORMAL:{size:3,value:c}}}}var Ne=`#version 300 es

#define SHADER_NAME column-layer-vertex-shader

in vec3 positions;
in vec3 normals;

in vec3 instancePositions;
in float instanceElevations;
in vec3 instancePositions64Low;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in float instanceStrokeWidths;

in vec3 instancePickingColors;
uniform float opacity;
uniform float radius;
uniform float angle;
uniform vec2 offset;
uniform bool extruded;
uniform bool stroked;
uniform bool isStroke;
uniform float coverage;
uniform float elevationScale;
uniform float edgeDistance;
uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform int radiusUnits;
uniform int widthUnits;
out vec4 vColor;
#ifdef FLAT_SHADING
out vec4 position_commonspace;
#endif

void main(void) {
  geometry.worldPosition = instancePositions;

  vec4 color = isStroke ? instanceLineColors : instanceFillColors;
  mat2 rotationMatrix = mat2(cos(angle), sin(angle), -sin(angle), cos(angle));
  float elevation = 0.0;
  float strokeOffsetRatio = 1.0;

  if (extruded) {
    elevation = instanceElevations * (positions.z + 1.0) / 2.0 * elevationScale;
  } else if (stroked) {
    float widthPixels = clamp(
      project_size_to_pixel(instanceStrokeWidths * widthScale, widthUnits),
      widthMinPixels, widthMaxPixels) / 2.0;
    float halfOffset = project_pixel_size(widthPixels) / project_size(edgeDistance * coverage * radius);
    if (isStroke) {
      strokeOffsetRatio -= sign(positions.z) * halfOffset;
    } else {
      strokeOffsetRatio -= halfOffset;
    }
  }
  float shouldRender = float(color.a > 0.0 && instanceElevations >= 0.0);
  float dotRadius = radius * coverage * shouldRender;

  geometry.pickingColor = instancePickingColors;
  vec3 centroidPosition = vec3(instancePositions.xy, instancePositions.z + elevation);
  vec3 centroidPosition64Low = instancePositions64Low;
  vec2 offset = (rotationMatrix * positions.xy * strokeOffsetRatio + offset) * dotRadius;
  if (radiusUnits == UNIT_METERS) {
    offset = project_size(offset);
  }
  vec3 pos = vec3(offset, 0.);
  DECKGL_FILTER_SIZE(pos, geometry);

  gl_Position = project_position_to_clipspace(centroidPosition, centroidPosition64Low, pos, geometry.position);
  geometry.normal = project_normal(vec3(rotationMatrix * normals.xy, normals.z));
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  if (extruded && !isStroke) {
#ifdef FLAT_SHADING
    position_commonspace = geometry.position;
    vColor = vec4(color.rgb, color.a * opacity);
#else
    vec3 lightColor = lighting_getLightColor(color.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);
    vColor = vec4(lightColor, color.a * opacity);
#endif
  } else {
    vColor = vec4(color.rgb, color.a * opacity);
  }
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Ue=`#version 300 es
#define SHADER_NAME column-layer-fragment-shader

precision highp float;

uniform vec3 project_uCameraPosition;
uniform bool extruded;
uniform bool isStroke;

out vec4 fragColor;

in vec4 vColor;
#ifdef FLAT_SHADING
in vec4 position_commonspace;
#endif

void main(void) {
  fragColor = vColor;
#ifdef FLAT_SHADING
  if (extruded && !isStroke && !picking_uActive) {
    vec3 normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
    fragColor.rgb = lighting_getLightColor(vColor.rgb, project_uCameraPosition, position_commonspace.xyz, normal);
  }
#endif
  DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;const F=[0,0,0,255],$e={diskResolution:{type:"number",min:4,value:20},vertices:null,radius:{type:"number",min:0,value:1e3},angle:{type:"number",value:0},offset:{type:"array",value:[0,0]},coverage:{type:"number",min:0,max:1,value:1},elevationScale:{type:"number",min:0,value:1},radiusUnits:"meters",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,extruded:!0,wireframe:!1,filled:!0,stroked:!1,getPosition:{type:"accessor",value:t=>t.position},getFillColor:{type:"accessor",value:F},getLineColor:{type:"accessor",value:F},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0,getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class R extends we{getShaders(){const{gl:e}=this.context,i=!_e(e),n={},s=this.props.flatShading&&Ae(e,Me.GLSL_DERIVATIVES);return s&&(n.FLAT_SHADING=1),super.getShaders({vs:Ne,fs:Ue,defines:n,transpileToGLSL100:i,modules:[ze,s?pe:ve,Pe]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceElevations:{size:1,transition:!0,accessor:"getElevation"},instanceFillColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getFillColor",defaultValue:F},instanceLineColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getLineColor",defaultValue:F},instanceStrokeWidths:{size:1,accessor:"getLineWidth",transition:!0}})}updateState(e){super.updateState(e);const{props:i,oldProps:n,changeFlags:s}=e,o=s.extensionsChanged||i.flatShading!==n.flatShading;if(o){var a;const{gl:r}=this.context;(a=this.state.model)===null||a===void 0||a.delete(),this.state.model=this._getModel(r),this.getAttributeManager().invalidateAll()}(o||i.diskResolution!==n.diskResolution||i.vertices!==n.vertices||(i.extruded||i.stroked)!==(n.extruded||n.stroked))&&this._updateGeometry(i)}getGeometry(e,i,n){const s=new Ve({radius:1,height:n?2:0,vertices:i,nradial:e});let o=0;if(i)for(let a=0;a<e;a++){const r=i[a];o+=Math.sqrt(r[0]*r[0]+r[1]*r[1])/e}else o=1;return this.setState({edgeDistance:Math.cos(Math.PI/e)*o}),s}_getModel(e){return new Le(e,{...this.getShaders(),id:this.props.id,isInstanced:!0})}_updateGeometry({diskResolution:e,vertices:i,extruded:n,stroked:s}){const o=this.getGeometry(e,i,n||s);this.setState({fillVertexCount:o.attributes.POSITION.value.length/3,wireframeVertexCount:o.indices.value.length}),this.state.model.setProps({geometry:o})}draw({uniforms:e}){const{lineWidthUnits:i,lineWidthScale:n,lineWidthMinPixels:s,lineWidthMaxPixels:o,radiusUnits:a,elevationScale:r,extruded:u,filled:l,stroked:d,wireframe:c,offset:g,coverage:h,radius:p,angle:f}=this.props,{model:v,fillVertexCount:y,wireframeVertexCount:S,edgeDistance:b}=this.state;v.setUniforms(e).setUniforms({radius:p,angle:f/180*Math.PI,offset:g,extruded:u,stroked:d,coverage:h,elevationScale:r,edgeDistance:b,radiusUnits:$[a],widthUnits:$[i],widthScale:n,widthMinPixels:s,widthMaxPixels:o}),u&&c&&(v.setProps({isIndexed:!0}),v.setVertexCount(S).setDrawMode(1).setUniforms({isStroke:!0}).draw()),l&&(v.setProps({isIndexed:!1}),v.setVertexCount(y).setDrawMode(5).setUniforms({isStroke:!1}).draw()),!u&&d&&(v.setProps({isIndexed:!1}),v.setVertexCount(y*2/3).setDrawMode(5).setUniforms({isStroke:!0}).draw())}}x(R,"layerName","ColumnLayer");x(R,"defaultProps",$e);function Be(){return new Worker("/assets/CsvGzipParser.worker.cbe5c650.js",{type:"module"})}const A={SUM:1,MEAN:2,MIN:3,MAX:4};function Z(t,e){return t+e}function je(t,e){return e>t?e:t}function Ge(t,e){return e<t?e:t}function We(t,e){if(Number.isFinite(e))return t.length?e:null;const i=t.map(e).filter(Number.isFinite);return i.length?i.reduce(Z,0)/i.length:null}function qe(t,e){if(Number.isFinite(e))return t.length?t.length*e:null;const i=t.map(e).filter(Number.isFinite);return i.length?i.reduce(Z,0):null}function Ye(t,e){if(Number.isFinite(e))return t.length?e:null;const i=t.map(e).filter(Number.isFinite);return i.length?i.reduce(je,-1/0):null}function Xe(t,e){if(Number.isFinite(e))return t.length?e:null;const i=t.map(e).filter(Number.isFinite);return i.length?i.reduce(Ge,1/0):null}function Ze(t,e,i){const n=A[t]||A.SUM;switch(e=Ke(e,i),n){case A.MIN:return s=>Xe(s,e);case A.SUM:return s=>qe(s,e);case A.MEAN:return s=>We(s,e);case A.MAX:return s=>Ye(s,e);default:return null}}function Ke(t,e={}){return Number.isFinite(t)?t:i=>(e.index=i.index,t(i.source,e))}function Qe(t,e={}){return i=>(e.indices=i.map(n=>n.index),t(i.map(n=>n.source),e))}const Je=[[255,255,178],[254,217,118],[254,178,76],[253,141,60],[240,59,32],[189,0,38]];function et(t,e){const i={};for(const n in t)e.includes(n)||(i[n]=t[n]);return i}class K extends He{constructor(...e){super(...e),x(this,"state",void 0)}initializeAggregationLayer(e){super.initializeState(this.context),this.setState({ignoreProps:et(this.constructor._propTypes,e.data.props),dimensions:e})}updateState(e){super.updateState(e);const{changeFlags:i}=e;if(i.extensionsChanged){const n=this.getShaders({});n&&n.defines&&(n.defines.NON_INSTANCED_MODEL=1),this.updateShaders(n)}this._updateAttributes()}updateAttributes(e){this.setState({changedAttributes:e})}getAttributes(){return this.getAttributeManager().getShaderAttributes()}getModuleSettings(){const{viewport:e,mousePosition:i,gl:n}=this.context;return Object.assign(Object.create(this.props),{viewport:e,mousePosition:i,pickingActive:0,devicePixelRatio:Ie(n)})}updateShaders(e){}isAggregationDirty(e,i={}){const{props:n,oldProps:s,changeFlags:o}=e,{compareAll:a=!1,dimension:r}=i,{ignoreProps:u}=this.state,{props:l,accessors:d=[]}=r,{updateTriggersChanged:c}=o;if(o.dataChanged)return!0;if(c){if(c.all)return!0;for(const g of d)if(c[g])return!0}if(a)return o.extensionsChanged?!0:Te({oldProps:s,newProps:n,ignoreProps:u,propTypes:this.constructor._propTypes});for(const g of l)if(n[g]!==s[g])return!0;return!1}isAttributeChanged(e){const{changedAttributes:i}=this.state;return e?i&&i[e]!==void 0:!tt(i)}_getAttributeManager(){return new Fe(this.context.gl,{id:this.props.id,stats:this.context.stats})}}x(K,"layerName","AggregationLayer");function tt(t){let e=!0;for(const i in t){e=!1;break}return e}function E(t,e,i){const n=i;return n.domain=()=>t,n.range=()=>e,n}function B(t,e){return E(t,e,n=>ct(t,e,n))}function it(t,e){return E(t,e,n=>ut(t,e,n))}function nt(t,e){const i=t.sort(Q);let n=0;const s=Math.max(1,e.length),o=new Array(s-1);for(;++n<s;)o[n-1]=st(i,n/s);const a=r=>at(o,e,r);return a.thresholds=()=>o,E(t,e,a)}function Q(t,e){return t-e}function st(t,e){const i=t.length;if(e<=0||i<2)return t[0];if(e>=1)return t[i-1];const n=(i-1)*e,s=Math.floor(n),o=t[s],a=t[s+1];return o+(a-o)*(n-s)}function ot(t,e){let i=0,n=t.length;for(;i<n;){const s=i+n>>>1;Q(t[s],e)>0?n=s:i=s+1}return i}function at(t,e,i){return e[ot(t,i)]}function rt(t,e,i,n){const s="".concat(n);let o=e.get(s);return o===void 0&&(o=t.push(n),e.set(s,o)),i[(o-1)%i.length]}function lt(t,e){const i=new Map,n=[];for(const o of t){const a="".concat(o);i.has(a)||i.set(a,n.push(o))}return E(t,e,o=>rt(n,i,e,o))}function ct(t,e,i){const n=t[1]-t[0];if(n<=0)return k.warn("quantizeScale: invalid domain, returning range[0]")(),e[0];const s=n/e.length,o=Math.floor((i-t[0])/s),a=Math.max(Math.min(o,e.length-1),0);return e[a]}function ut(t,e,i){return(i-t[0])/(t[1]-t[0])*(e[1]-e[0])+e[0]}function J(t){return t!=null}function gt(t){const e=[];return t.forEach(i=>{!e.includes(i)&&J(i)&&e.push(i)}),e}function ee(t,e){return(typeof e=="function"?t.map(e):t).filter(J)}function dt(t,e){return ee(t,e)}function ht(t,e){return gt(ee(t,e))}function mt(t,e,i){return Math.max(e,Math.min(i,t))}function ft(t){switch(t){case"quantize":return B;case"linear":return it;case"quantile":return nt;case"ordinal":return lt;default:return B}}const te=t=>t.length,pt=3402823466e29,ie=t=>t.points,ne=t=>t.index,j=(t,e)=>t<e?-1:t>e?1:t>=e?0:NaN,vt={getValue:te,getPoints:ie,getIndex:ne,filterData:null};class yt{constructor(e=[],i=vt){x(this,"maxCount",void 0),x(this,"maxValue",void 0),x(this,"minValue",void 0),x(this,"totalCount",void 0),x(this,"aggregatedBins",void 0),x(this,"sortedBins",void 0),x(this,"binMap",void 0),this.aggregatedBins=this.getAggregatedBins(e,i),this._updateMinMaxValues(),this.binMap=this.getBinMap()}getAggregatedBins(e,i){const{getValue:n=te,getPoints:s=ie,getIndex:o=ne,filterData:a}=i,r=typeof a=="function",u=e.length,l=[];let d=0;for(let c=0;c<u;c++){const g=e[c],h=s(g),p=o(g),f=r?h.filter(a):h;g.filteredPoints=r?f:null;const v=f.length?n(f):null;v!=null&&(l[d]={i:Number.isFinite(p)?p:c,value:v,counts:f.length},d++)}return l}_percentileToIndex(e){const i=this.sortedBins.length;if(i<2)return[0,0];const[n,s]=e.map(r=>mt(r,0,100)),o=Math.ceil(n/100*(i-1)),a=Math.floor(s/100*(i-1));return[o,a]}getBinMap(){const e={};for(const i of this.aggregatedBins)e[i.i]=i;return e}_updateMinMaxValues(){let e=0,i=0,n=pt,s=0;for(const o of this.aggregatedBins)e=e>o.counts?e:o.counts,i=i>o.value?i:o.value,n=n<o.value?n:o.value,s+=o.counts;this.maxCount=e,this.maxValue=i,this.minValue=n,this.totalCount=s}getValueRange(e){if(this.sortedBins||(this.sortedBins=this.aggregatedBins.sort((s,o)=>j(s.value,o.value))),!this.sortedBins.length)return[];let i=0,n=this.sortedBins.length-1;if(Array.isArray(e)){const s=this._percentileToIndex(e);i=s[0],n=s[1]}return[this.sortedBins[i].value,this.sortedBins[n].value]}getValueDomainByScale(e,[i=0,n=100]=[]){if(this.sortedBins||(this.sortedBins=this.aggregatedBins.sort((o,a)=>j(o.value,a.value))),!this.sortedBins.length)return[];const s=this._percentileToIndex([i,n]);return this._getScaleDomain(e,s)}_getScaleDomain(e,[i,n]){const s=this.sortedBins;switch(e){case"quantize":case"linear":return[s[i].value,s[n].value];case"quantile":return dt(s.slice(i,n+1),o=>o.value);case"ordinal":return ht(s,o=>o.value);default:return[s[i].value,s[n].value]}}}function G(){}const W=["getBins","getDomain","getScaleFunc"],q=[{key:"fillColor",accessor:"getFillColor",pickingInfo:"colorValue",getBins:{triggers:{value:{prop:"getColorValue",updateTrigger:"getColorValue"},weight:{prop:"getColorWeight",updateTrigger:"getColorWeight"},aggregation:{prop:"colorAggregation"},filterData:{prop:"_filterData",updateTrigger:"_filterData"}}},getDomain:{triggers:{lowerPercentile:{prop:"lowerPercentile"},upperPercentile:{prop:"upperPercentile"},scaleType:{prop:"colorScaleType"}}},getScaleFunc:{triggers:{domain:{prop:"colorDomain"},range:{prop:"colorRange"}},onSet:{props:"onSetColorDomain"}},nullValue:[0,0,0,0]},{key:"elevation",accessor:"getElevation",pickingInfo:"elevationValue",getBins:{triggers:{value:{prop:"getElevationValue",updateTrigger:"getElevationValue"},weight:{prop:"getElevationWeight",updateTrigger:"getElevationWeight"},aggregation:{prop:"elevationAggregation"},filterData:{prop:"_filterData",updateTrigger:"_filterData"}}},getDomain:{triggers:{lowerPercentile:{prop:"elevationLowerPercentile"},upperPercentile:{prop:"elevationUpperPercentile"},scaleType:{prop:"elevationScaleType"}}},getScaleFunc:{triggers:{domain:{prop:"elevationDomain"},range:{prop:"elevationRange"}},onSet:{props:"onSetElevationDomain"}},nullValue:-1}],St=t=>t.cellSize;class xt{constructor(e){this.state={layerData:{},dimensions:{}},this.changeFlags={},this.dimensionUpdaters={},this._getCellSize=e.getCellSize||St,this._getAggregator=e.getAggregator,this._addDimension(e.dimensions||q)}static defaultDimensions(){return q}updateState(e,i){const{oldProps:n,props:s,changeFlags:o}=e;this.updateGetValueFuncs(n,s,o);const a=this.needsReProjectPoints(n,s,o);let r=!1;return o.dataChanged||a?(this.getAggregatedData(s,i),r=!0):((this.getDimensionChanges(n,s,o)||[]).forEach(l=>typeof l=="function"&&l()),r=!0),this.setState({aggregationDirty:r}),this.state}setState(e){this.state={...this.state,...e}}setDimensionState(e,i){this.setState({dimensions:{...this.state.dimensions,[e]:{...this.state.dimensions[e],...i}}})}normalizeResult(e={}){return e.hexagons?{data:e.hexagons,...e}:e.layerData?{data:e.layerData,...e}:e}getAggregatedData(e,i){const s=this._getAggregator(e)(e,i);this.setState({layerData:this.normalizeResult(s)}),this.changeFlags={layerData:!0},this.getSortedBins(e)}updateGetValueFuncs(e,i,n){for(const s in this.dimensionUpdaters){const{value:o,weight:a,aggregation:r}=this.dimensionUpdaters[s].getBins.triggers;let u=i[o.prop];this.needUpdateDimensionStep(this.dimensionUpdaters[s].getBins,e,i,n)&&(u?u=Qe(u,{data:i.data}):u=Ze(i[r.prop],i[a.prop],{data:i.data})),u&&this.setDimensionState(s,{getValue:u})}}needsReProjectPoints(e,i,n){return this._getCellSize(e)!==this._getCellSize(i)||this._getAggregator(e)!==this._getAggregator(i)||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getPosition)}addDimension(e){this._addDimension(e)}_addDimension(e=[]){e.forEach(i=>{const{key:n}=i;this.dimensionUpdaters[n]=this.getDimensionUpdaters(i),this.state.dimensions[n]={getValue:null,domain:null,sortedBins:null,scaleFunc:G}})}getDimensionUpdaters({key:e,accessor:i,pickingInfo:n,getBins:s,getDomain:o,getScaleFunc:a,nullValue:r}){return{key:e,accessor:i,pickingInfo:n,getBins:{updater:this.getDimensionSortedBins,...s},getDomain:{updater:this.getDimensionValueDomain,...o},getScaleFunc:{updater:this.getDimensionScale,...a},attributeAccessor:this.getSubLayerDimensionAttribute(e,r)}}needUpdateDimensionStep(e,i,n,s){return Object.values(e.triggers).some(o=>o.updateTrigger?s.dataChanged||s.updateTriggersChanged&&(s.updateTriggersChanged.all||s.updateTriggersChanged[o.updateTrigger]):i[o.prop]!==n[o.prop])}getDimensionChanges(e,i,n){const s=[];for(const o in this.dimensionUpdaters){const a=W.find(r=>this.needUpdateDimensionStep(this.dimensionUpdaters[o][r],e,i,n));a&&s.push(this.dimensionUpdaters[o][a].updater.bind(this,i,this.dimensionUpdaters[o]))}return s.length?s:null}getUpdateTriggers(e){const i=e.updateTriggers||{},n={};for(const s in this.dimensionUpdaters){const{accessor:o}=this.dimensionUpdaters[s];n[o]={},W.forEach(a=>{Object.values(this.dimensionUpdaters[s][a].triggers).forEach(({prop:r,updateTrigger:u})=>{if(u){const l=i[u];typeof l=="object"&&!Array.isArray(l)?Object.assign(n[o],l):l!==void 0&&(n[o][r]=l)}else n[o][r]=e[r]})})}return n}getSortedBins(e){for(const i in this.dimensionUpdaters)this.getDimensionSortedBins(e,this.dimensionUpdaters[i])}getDimensionSortedBins(e,i){const{key:n}=i,{getValue:s}=this.state.dimensions[n],o=new yt(this.state.layerData.data||[],{getValue:s,filterData:e._filterData});this.setDimensionState(n,{sortedBins:o}),this.getDimensionValueDomain(e,i)}getDimensionValueDomain(e,i){const{getDomain:n,key:s}=i,{triggers:{lowerPercentile:o,upperPercentile:a,scaleType:r}}=n,u=this.state.dimensions[s].sortedBins.getValueDomainByScale(e[r.prop],[e[o.prop],e[a.prop]]);this.setDimensionState(s,{valueDomain:u}),this.getDimensionScale(e,i)}getDimensionScale(e,i){const{key:n,getScaleFunc:s,getDomain:o}=i,{domain:a,range:r}=s.triggers,{scaleType:u}=o.triggers,{onSet:l}=s,d=e[r.prop],c=e[a.prop]||this.state.dimensions[n].valueDomain,h=ft(u&&e[u.prop])(c,d);typeof l=="object"&&typeof e[l.props]=="function"&&e[l.props](h.domain()),this.setDimensionState(n,{scaleFunc:h})}getSubLayerDimensionAttribute(e,i){return n=>{const{sortedBins:s,scaleFunc:o}=this.state.dimensions[e],a=s.binMap[n.index];if(a&&a.counts===0)return i;const r=a&&a.value,u=o.domain();return r>=u[0]&&r<=u[u.length-1]?o(r):i}}getSubLayerAccessors(e){const i={};for(const n in this.dimensionUpdaters){const{accessor:s}=this.dimensionUpdaters[n];i[s]=this.getSubLayerDimensionAttribute(e,n)}return i}getPickingInfo({info:e}){const i=e.picked&&e.index>-1;let n=null;if(i){const s=this.state.layerData.data[e.index],o={};for(const a in this.dimensionUpdaters){const{pickingInfo:r}=this.dimensionUpdaters[a],{sortedBins:u}=this.state.dimensions[a],l=u.binMap[s.index]&&u.binMap[s.index].value;o[r]=l}n=Object.assign(o,s,{points:s.filteredPoints||s.points})}return e.picked=Boolean(n),e.object=n,e}getAccessor(e){return this.dimensionUpdaters.hasOwnProperty(e)?this.dimensionUpdaters[e].attributeAccessor:G}}var M=Math.PI/3,bt=[0,M,2*M,3*M,4*M,5*M];function Ct(t){return t[0]}function Dt(t){return t[1]}function wt(){var t=0,e=0,i=1,n=1,s=Ct,o=Dt,a,r,u;function l(c){var g={},h=[],p,f=c.length;for(p=0;p<f;++p)if(!(isNaN(y=+s.call(null,v=c[p],p,c))||isNaN(S=+o.call(null,v,p,c)))){var v,y,S,b=Math.round(S=S/u),C=Math.round(y=y/r-(b&1)/2),P=S-b;if(Math.abs(P)*3>1){var m=y-C,D=C+(y<C?-1:1)/2,L=b+(S<b?-1:1),T=y-D,V=S-L;m*m+P*P>T*T+V*V&&(C=D+(b&1?1:-1)/2,b=L)}var O=C+"-"+b,I=g[O];I?I.push(v):(h.push(I=g[O]=[v]),I.x=(C+(b&1)/2)*r,I.y=b*u)}return h}function d(c){var g=0,h=0;return bt.map(function(p){var f=Math.sin(p)*c,v=-Math.cos(p)*c,y=f-g,S=v-h;return g=f,h=v,[y,S]})}return l.hexagon=function(c){return"m"+d(c==null?a:+c).join("l")+"z"},l.centers=function(){for(var c=[],g=Math.round(e/u),h=Math.round(t/r),p=g*u;p<n+a;p+=u,++g)for(var f=h*r+(g&1)*r/2;f<i+r/2;f+=r)c.push([f,p]);return c},l.mesh=function(){var c=d(a).slice(0,4).join("l");return l.centers().map(function(g){return"M"+g+"m"+c}).join("")},l.x=function(c){return arguments.length?(s=c,l):s},l.y=function(c){return arguments.length?(o=c,l):o},l.radius=function(c){return arguments.length?(a=+c,r=a*2*Math.sin(M),u=a*1.5,l):a},l.size=function(c){return arguments.length?(t=e=0,i=+c[0],n=+c[1],l):[i-t,n-e]},l.extent=function(c){return arguments.length?(t=+c[0][0],e=+c[0][1],i=+c[1][0],n=+c[1][1],l):[[t,e],[i,n]]},l.radius(1)}function _t(t,e){const{data:i,radius:n}=t,{viewport:s,attributes:o}=e,a=i.length?At(i,e):null,r=Mt(n,s,a),u=[],{iterable:l,objectInfo:d}=ke(i),c=o.positions.value,{size:g}=o.positions.getAccessor();for(const f of l){d.index++;const v=d.index*g,y=[c[v],c[v+1]];Number.isFinite(y[0])&&Number.isFinite(y[1])?u.push({screenCoord:s.projectFlat(y),source:f,index:d.index}):k.warn("HexagonLayer: invalid position")()}return{hexagons:wt().radius(r).x(f=>f.screenCoord[0]).y(f=>f.screenCoord[1])(u).map((f,v)=>({position:s.unprojectFlat([f.x,f.y]),points:f,index:v})),radiusCommon:r}}function At(t,e){const{attributes:i}=e,n=i.positions.value,{size:s}=i.positions.getAccessor();let o=1/0,a=1/0,r=-1/0,u=-1/0,l;for(l=0;l<s*t.length;l+=s){const d=n[l],c=n[l+1];Number.isFinite(d)&&Number.isFinite(c)&&(o=Math.min(d,o),r=Math.max(d,r),a=Math.min(c,a),u=Math.max(c,u))}return[o,a,r,u].every(Number.isFinite)?[(o+r)/2,(a+u)/2]:null}function Mt(t,e,i){const{unitsPerMeter:n}=e.getDistanceScales(i);return t*n[0]}function Y(){}const zt={colorDomain:null,colorRange:Je,getColorValue:{type:"accessor",value:null},getColorWeight:{type:"accessor",value:1},colorAggregation:"SUM",lowerPercentile:{type:"number",value:0,min:0,max:100},upperPercentile:{type:"number",value:100,min:0,max:100},colorScaleType:"quantize",onSetColorDomain:Y,elevationDomain:null,elevationRange:[0,1e3],getElevationValue:{type:"accessor",value:null},getElevationWeight:{type:"accessor",value:1},elevationAggregation:"SUM",elevationLowerPercentile:{type:"number",value:0,min:0,max:100},elevationUpperPercentile:{type:"number",value:100,min:0,max:100},elevationScale:{type:"number",min:0,value:1},elevationScaleType:"linear",onSetElevationDomain:Y,radius:{type:"number",value:1e3,min:1},coverage:{type:"number",min:0,max:1,value:1},extruded:!1,hexagonAggregator:_t,getPosition:{type:"accessor",value:t=>t.position},material:!0,_filterData:{type:"function",value:null,optional:!0}};class H extends K{constructor(...e){super(...e),x(this,"state",void 0)}initializeState(){const e=new xt({getAggregator:n=>n.hexagonAggregator,getCellSize:n=>n.radius});this.state={cpuAggregator:e,aggregatorState:e.state,vertices:null},this.getAttributeManager().add({positions:{size:3,type:5130,accessor:"getPosition"}})}updateState(e){if(super.updateState(e),e.changeFlags.propsOrDataChanged){const i=this.state.cpuAggregator.updateState(e,{viewport:this.context.viewport,attributes:this.getAttributes()});if(this.state.aggregatorState.layerData!==i.layerData){const{hexagonVertices:n}=i.layerData||{};this.setState({vertices:n&&this.convertLatLngToMeterOffset(n)})}this.setState({aggregatorState:i})}}convertLatLngToMeterOffset(e){const{viewport:i}=this.context;if(Array.isArray(e)&&e.length===6){const n=e[0],s=e[3],o=[(n[0]+s[0])/2,(n[1]+s[1])/2],a=i.projectFlat(o),{metersPerUnit:r}=i.getDistanceScales(o);return e.map(l=>{const d=i.projectFlat(l);return[(d[0]-a[0])*r[0],(d[1]-a[1])*r[1]]})}return k.error("HexagonLayer: hexagonVertices needs to be an array of 6 points")(),null}getPickingInfo({info:e}){return this.state.cpuAggregator.getPickingInfo({info:e})}_onGetSublayerColor(e){return this.state.cpuAggregator.getAccessor("fillColor")(e)}_onGetSublayerElevation(e){return this.state.cpuAggregator.getAccessor("elevation")(e)}_getSublayerUpdateTriggers(){return this.state.cpuAggregator.getUpdateTriggers(this.props)}renderLayers(){const{elevationScale:e,extruded:i,coverage:n,material:s,transitions:o}=this.props,{aggregatorState:a,vertices:r}=this.state,u=this.getSubLayerClass("hexagon-cell",R),l=this._getSublayerUpdateTriggers(),d=r?{vertices:r,radius:1}:{radius:a.layerData.radiusCommon||1,radiusUnits:"common",angle:90};return new u({...d,diskResolution:6,elevationScale:e,extruded:i,coverage:n,material:s,getFillColor:this._onGetSublayerColor.bind(this),getElevation:this._onGetSublayerElevation.bind(this),transitions:o&&{getFillColor:o.getColorValue||o.getColorWeight,getElevation:o.getElevationValue||o.getElevationWeight}},this.getSubLayerProps({id:"hexagon-cell",updateTriggers:l}),{data:a.layerData.data})}}x(H,"layerName","HexagonLayer");x(H,"defaultProps",zt);const Pt={ambient:.64,diffuse:.6,shininess:32,specularColor:[51,51,51]},Lt={zoom:10,longitude:13.45,latitude:52.5,pitch:0,bearing:0};function It({viewId:t=0,colorRamp:e="chlorophyll",coverage:i=.65,dark:n=!1,data:s={raw:new Float32Array(0),length:0},extrude:o=!0,highlights:a=[],mapIsIndependent:r=!1,maxHeight:u=200,metric:l="Count",radius:d=100,selectedHexStats:c={rows:0,numHexagons:0,selectedHexagonIds:[]},upperPercentile:g=100,onClick:h={}}){const[p,f]=se.exports.useState(Lt);w[t]=m=>{f(m||z.state.viewState)};function v(m){!m.latitude||(m.center||(m.center=[0,0]),m.center[0]=m.longitude,m.center[1]=m.latitude,f(m),r||z.commit("setMapCamera",m))}const y=Ee({colormap:e,nshades:10,format:"rba",alpha:1}).map(m=>[m[0],m[1],m[2]]);function S({object:m}){if(!m||!m.position||!m.position.length)return null;const D=m.position[1],L=m.position[0],T=m.points.length;return{html:`        <b>${a.length?"Count":l}: ${T} </b><br/>
        ${Number.isFinite(D)?D.toFixed(4):""} / ${Number.isFinite(L)?L.toFixed(4):""}
      `,style:n?{color:"#ccc",backgroundColor:"#2a3c4f"}:{color:"#223",backgroundColor:"white"}}}function b(m,D){h(m,D)}let C=null;a.length?C=a.map(m=>m[1]):s.length?C={length:s.length,attributes:{getPosition:{value:s.raw,size:2}}}:C=null;const P=[new Re({id:"arc-layer",data:a,getSourcePosition:m=>m[0],getTargetPosition:m=>m[1],pickable:!1,opacity:.4,getHeight:0,getWidth:1,getSourceColor:n?[144,96,128]:[192,192,240],getTargetColor:n?[144,96,128]:[192,192,240]}),new H({id:"hexlayer",data:C,getPosition:a.length?m=>m:null,colorRange:n?y.slice(1):y.reverse().slice(1),coverage:i,autoHighlight:!0,elevationRange:[0,u],elevationScale:s&&s.length?50:0,extruded:o,selectedHexStats:c,pickable:!0,opacity:.7,radius:d,upperPercentile:g,material:Pt,transitions:{elevationScale:{type:"interpolation",duration:1e3},opacity:{type:"interpolation",duration:200}}})];return N.createElement(xe,{layers:P,controller:!0,useDevicePixels:!1,viewState:p,getTooltip:S,onClick:b,onViewStateChange:m=>v(m.viewState)},N.createElement(be,{mapStyle:z.getters.mapStyle,preventStyleDiffing:!0,mapboxApiAccessToken:oe}))}const Tt={messages:{en:{loading:"Loading data...",sorting:"Sorting into bins...",aggregate:"Summary",maxHeight:"3D Height",showDetails:"Show Details",selection:"Selection",areas:"Areas",count:"Count"},de:{loading:"Dateien laden...",sorting:"Sortieren...",aggregate:"Daten",maxHeight:"3-D H\xF6he",showDetails:"Details anzeigen",selection:"Ausgew\xE4hlt",areas:"Orte",count:"Anzahl"}}},Ft=ae({name:"XyHexagonsPlugin",i18n:Tt,components:{CollapsiblePanel:he,DrawingTool:ye,XyHexDeckMap:It,VueSlider:ce,ToggleButton:ue.exports.ToggleButton,ZoomButtons:Se},props:{root:{type:String,required:!0},subfolder:{type:String,required:!0},yamlConfig:String,config:Object,thumbnail:Boolean},data:()=>{const t=["bathymetry","par","chlorophyll","magma"];return{id:`id-${Math.floor(1e12*Math.random())}`,standaloneYAMLconfig:{title:"",description:"",file:"",projection:"",thumbnail:"",aggregations:{},radius:250,maxHeight:0,center:null,zoom:9,mapIsIndependent:!1},YAMLrequirementsXY:{file:"",aggregations:{}},colorRamps:t,buttonColors:["#5E8AAE","#BF7230","#269367","#9C439C"],aggregations:{},columnLookup:[],gzipWorker:null,colorRamp:t[0],globalState:z.state,vizDetails:{title:"",description:"",file:"",projection:"",thumbnail:"",aggregations:{},radius:250,maxHeight:0,center:null,zoom:9},myState:{statusMessage:"",subfolder:"",yamlConfig:"",thumbnail:!1},rowCache:{},requests:{raw:new Float32Array(0),length:0},highlightedTrips:[],searchTerm:"",searchEnabled:!1,isLoaded:!1,activeAggregation:"",isHighlightingZone:!1,multiSelectedHexagons:{},thumbnailUrl:"url('assets/thumbnail.jpg') no-repeat;",hexStats:null,resizer:null}},computed:{fileApi(){return new de(this.fileSystem,z)},fileSystem(){const t=this.$store.state.svnProjects.filter(e=>e.slug===this.root);if(t.length===0)throw console.log("no such project"),Error;return t[0]},urlThumbnail(){return this.thumbnailUrl},buttonLabel(){const[t,e]=this.activeAggregation.split("~");return this.aggregations[t][e].title},extrudeTowers(){return this.vizDetails.maxHeight>0},mapProps(){return{viewId:this.id,colorRamp:this.colorRamp,coverage:.65,dark:this.$store.state.isDarkMode,data:this.requests,extrude:this.extrudeTowers,highlights:this.highlightedTrips,mapIsIndependent:this.vizDetails.mapIsIndependent,maxHeight:this.vizDetails.maxHeight,metric:this.buttonLabel,radius:this.vizDetails.radius,selectedHexStats:this.hexStats,upperPercentile:100,onClick:this.handleClick}},textColor(){const t={text:"#3498db",bg:"#eeeef480"},e={text:"white",bg:"#181518aa"};return this.$store.state.colorScheme===re.DarkMode?e:t}},watch:{extrudeTowers(){this.extrudeTowers&&this.globalState.viewState.pitch==0&&z.commit("setMapCamera",Object.assign({},this.globalState.viewState,{pitch:10}))},"$store.state.viewState"(){this.vizDetails.mapIsIndependent||w[this.id]&&w[this.id]()}},methods:{handleClick(t,e){console.log({target:t,event:e}),t.layer?this.handleHexClick(t,e):this.handleEmptyClick()},handleEmptyClick(){this.flipViewToShowInvertedData({})},handleHexClick(t,e){var n;if(!e.srcEvent.shiftKey){this.multiSelectedHexagons={},this.hexStats=null,this.flipViewToShowInvertedData(t);return}const i=(n=t==null?void 0:t.object)==null?void 0:n.index;i!==void 0&&(i in this.multiSelectedHexagons?delete this.multiSelectedHexagons[i]:this.multiSelectedHexagons[i]=t.object.points,this.hexStats=this.selectedHexagonStatistics())},flipViewToShowInvertedData(t){this.isHighlightingZone?this.isHighlightingZone=!1:t.object?this.isHighlightingZone=!0:this.isHighlightingZone=!1;const e=this.activeAggregation.split("~");let i=0,n=0;if(!this.isHighlightingZone)this.hexStats=null,this.multiSelectedHexagons={},this.handleOrigDest(e[0],parseInt(e[1]));else{i=parseInt(e[1]),n=i%2?i-1:i+1;const s=`${e[0]}${i}`,o=this.rowCache[s],a=`${e[0]}${n}`,r=this.rowCache[a],u=[];for(const l of t.object.points){const d=l.index*2,c=[r.raw[d],r.raw[d+1]];u.push([[o.raw[d],o.raw[d+1]],c]),this.highlightedTrips=u}this.hexStats&&(this.hexStats.selectedHexagonIds=[]),this.multiSelectedHexagons={},this.colorRamp=this.colorRamps[n]}this.isHighlightingZone||(this.highlightedTrips=[])},async handleOrigDest(t,e){const i=t+e;this.hexStats=null,this.multiSelectedHexagons={},this.highlightedTrips=[],this.activeAggregation=`${t}~${e}`,this.requests=this.rowCache[i],this.colorRamp=this.colorRamps[e]},async solveProjection(){if(!this.thumbnail){console.log("WHAT PROJECTION:");try{const t=await this.fileApi.getFileText(this.myState.subfolder+"/"+this.myState.yamlConfig);this.vizDetails=U.parse(t)}catch(t){console.error(t)}}},async getVizDetails(){if(this.config){this.validateYAML(),this.vizDetails=Object.assign({},this.config),this.setRadiusAndHeight();return}new RegExp(".*(yml|yaml)$").test(this.myState.yamlConfig)?await this.loadStandaloneYAMLConfig():this.loadOutputTripsConfig()},loadOutputTripsConfig(){let t="EPSG:31468";this.myState.thumbnail||(t=prompt('Enter projection: e.g. "EPSG:31468"')||"EPSG:31468",parseInt(t,10)&&(t="EPSG:"+t)),this.vizDetails={title:"Output Trips",description:this.myState.yamlConfig,file:this.myState.yamlConfig,projection:t,aggregations:{"Trip Summary":[{title:"Origins",x:"start_x",y:"start_y"},{title:"Destinations",x:"end_x",y:"end_y"}]},radius:this.vizDetails.radius,maxHeight:this.vizDetails.maxHeight,center:this.vizDetails.center,zoom:this.vizDetails.zoom},this.$emit("title",this.vizDetails.title)},setRadiusAndHeight(){this.vizDetails.radius||(this.vizDetails.radius=250),this.vizDetails.maxHeight||(this.vizDetails.maxHeight=0)},async loadStandaloneYAMLConfig(){try{const t=this.myState.yamlConfig.indexOf("/")>-1?this.myState.yamlConfig:this.myState.subfolder+"/"+this.myState.yamlConfig,e=await this.fileApi.getFileText(t);this.standaloneYAMLconfig=Object.assign({},U.parse(e)),this.validateYAML(),this.setVizDetails()}catch{console.log("failed"),this.$store.commit("setStatus",{type:_.ERROR,msg:"File not found",desc:`Could not find: ${this.myState.subfolder}/${this.myState.yamlConfig}`})}},validateYAML(){console.log("in yaml validation 2");const t=new RegExp(".*(yml|yaml)$").test(this.myState.yamlConfig);let e={};t?(console.log("has yaml"),e=this.standaloneYAMLconfig):(console.log("no yaml"),e=this.config);for(const i in this.YAMLrequirementsXY)i in e||this.$store.commit("setStatus",{type:_.ERROR,msg:`${this.yamlConfig}: missing required key: ${i}`,desc:"Check this.YAMLrequirementsXY for required keys"});e.radius==0&&this.$store.commit("setStatus",{type:_.WARNING,msg:"Radius set to zero",desc:"Radius can not be zero, preset value used instead. "}),(e.zoom<5||e.zoom>20)&&this.$store.commit("setStatus",{type:_.WARNING,msg:"Zoom is out of the recommended range ",desc:"Zoom levels should be between 5 and 20. "})},setVizDetails(){this.vizDetails=Object.assign({},this.vizDetails,this.standaloneYAMLconfig),this.setRadiusAndHeight();const t=this.vizDetails.title?this.vizDetails.title:"Hex Aggregation";this.$emit("title",t)},async buildThumbnail(){if(this.thumbnail&&this.vizDetails.thumbnail)try{const e=await(await this.fileApi.getFileBlob(this.myState.subfolder+"/"+this.vizDetails.thumbnail)).arrayBuffer(),i=ge.arrayBufferToBase64(e);i&&(this.thumbnailUrl=`center / cover no-repeat url(data:image/png;base64,${i})`)}catch(t){console.error(t)}},handleShowSelectionButton(){const t=Object.values(this.multiSelectedHexagons);let e=[];t.map(n=>e=e.concat(n));const i={object:{points:e}};this.flipViewToShowInvertedData(i)},selectedHexagonStatistics(){const t=Object.keys(this.multiSelectedHexagons).map(n=>parseInt(n));return t.length?{rows:Object.values(this.multiSelectedHexagons).reduce((n,s)=>n+s.length,0),numHexagons:t.length,selectedHexagonIds:t}:null},async setMapCenter(){const t=Object.values(this.rowCache)[0].raw;if(this.vizDetails.center){typeof this.vizDetails.center=="string"&&(this.vizDetails.center=this.vizDetails.center.split(",").map(Number));const r={longitude:this.vizDetails.center[0],latitude:this.vizDetails.center[1],bearing:0,pitch:0,zoom:this.vizDetails.zoom||10,jump:!1};w[this.id]&&w[this.id](r);return}if(!t.length)return;let e=0,i=0,n=0;const s=t.length/2,o=512;for(let r=0;r<s;r+=o)i+=t[r*2],n+=t[r*2+1],e++;i=i/e,n=n/e;const a=this.$store.state.viewState;i&&n&&this.$store.commit("setMapCamera",{longitude:i,latitude:n,bearing:a.bearing,pitch:a.pitch,zoom:this.vizDetails.zoom||a.zoom,jump:!1})},setupLogoMover(){this.resizer=new ResizeObserver(this.moveLogo);const t=document.getElementById(`id-${this.id}`);this.resizer.observe(t)},moveLogo(){const t=document.getElementById(`id-${this.id}`),e=t==null?void 0:t.querySelector(".mapboxgl-ctrl-bottom-left");if(e){const i=t.clientWidth>640?"280px":"36px";e.style.right=i}},async parseCSVFile(t){this.myState.statusMessage="Loading file...",this.gzipWorker=new Be,this.gzipWorker.onmessage=async e=>{if(e.data.status)this.myState.statusMessage=e.data.status;else if(e.data.error)this.myState.statusMessage=e.data.error,this.$store.commit("setStatus",{type:_.ERROR,msg:"Loading Error",desc:"Error loading: ${this.myState.subfolder}/${this.vizDetails.file}"});else{const{rowCache:i,columnLookup:n}=e.data;this.gzipWorker&&this.gzipWorker.terminate(),this.dataIsLoaded({rowCache:i,columnLookup:n})}},this.gzipWorker.postMessage({filepath:t,fileSystem:this.fileSystem,aggregations:this.vizDetails.aggregations,projection:this.vizDetails.projection})},dataIsLoaded({rowCache:t,columnLookup:e}){this.columnLookup=e,this.rowCache=t;const i=this.activeAggregation.replaceAll("~","");this.requests=this.rowCache[i],this.setMapCenter(),this.moveLogo(),this.myState.statusMessage=""},async loadFiles(){let t=[];if(!this.fileApi)return{dataArray:t};try{let e=`${this.myState.subfolder}/${this.vizDetails.file}`;await this.parseCSVFile(e)}catch(e){console.error(e),this.myState.statusMessage=""+e,this.$store.commit("setStatus",{type:_.ERROR,msg:"Loading/Parsing Error",desc:"Error loading/parsing: ${this.myState.subfolder}/${this.vizDetails.file}"})}}},async mounted(){this.$store.commit("setFullScreen",!this.thumbnail),this.myState.thumbnail=this.thumbnail,this.myState.yamlConfig=this.yamlConfig||"",this.myState.subfolder=this.subfolder,await this.getVizDetails(),!this.thumbnail&&(this.setupLogoMover(),this.myState.statusMessage=`${this.$i18n.t("loading")}`,this.aggregations=this.vizDetails.aggregations,await this.loadFiles(),this.buildThumbnail(),this.isLoaded=!0,this.handleOrigDest(Object.keys(this.aggregations)[0],0))},beforeDestroy(){w[this.id]=void 0,delete w[this.id];try{this.gzipWorker&&this.gzipWorker.terminate()}catch(t){console.warn(t)}this.$store.commit("setFullScreen",!1)}});var kt=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"xy-hexagons",class:{"hide-thumbnail":!t.thumbnail},attrs:{oncontextmenu:"return false",id:`id-${t.id}`}},[!t.thumbnail&&t.isLoaded?i("xy-hex-deck-map",t._b({staticClass:"hex-layer"},"xy-hex-deck-map",t.mapProps,!1)):t._e(),t.thumbnail?t._e():i("zoom-buttons"),t.thumbnail?t._e():i("drawing-tool",{staticClass:"drawing-tool"}),t.isLoaded&&!t.thumbnail&&t.vizDetails.title?i("div",{staticClass:"left-side"},[i("collapsible-panel",{attrs:{direction:"left",locked:!0}},[t.hexStats?i("div",{staticClass:"panel-items",staticStyle:{color:"#c0f"}},[i("p",{staticClass:"big",staticStyle:{"margin-top":"2rem"}},[t._v(t._s(t.$t("selection"))+":")]),i("h3",{staticStyle:{"margin-top":"-1rem"}},[t._v(t._s(t.$t("areas"))+": "+t._s(t.hexStats.numHexagons)+", "+t._s(t.$t("count"))+": "+t._s(t.hexStats.rows))]),i("button",{staticClass:"button",staticStyle:{color:"#c0f","border-color":"#c0f"},on:{click:t.handleShowSelectionButton}},[t._v(t._s(t.$t("showDetails")))])]):t._e()])],1):t._e(),t.isLoaded&&!t.thumbnail&&!t.myState.statusMessage?i("div",{staticClass:"control-panel"},[t._l(Object.keys(t.aggregations),function(n){return i("div",{key:n,staticClass:"panel-item"},[i("p",{staticClass:"speed-label"},[t._v(t._s(n))]),t._l(t.aggregations[n],function(s,o){return i("button",{key:o,staticClass:"button is-small aggregation-button",style:{"margin-bottom":"0.25rem",color:t.activeAggregation===`${n}~${o}`?"white":t.buttonColors[o],border:`1px solid ${t.buttonColors[o]}`,"border-right":`0.4rem solid ${t.buttonColors[o]}`,"border-radius":"4px","background-color":t.activeAggregation===`${n}~${o}`?t.buttonColors[o]:t.$store.state.isDarkMode?"#333":"white"},on:{click:function(a){return t.handleOrigDest(n,o)}}},[t._v(t._s(s.title))])})],2)}),i("div",{staticClass:"panel-item right"},[i("p",{staticClass:"speed-label"},[t._v(t._s(t.$t("maxHeight"))+": "+t._s(t.vizDetails.maxHeight))]),i("vue-slider",{staticClass:"speed-slider",attrs:{min:0,max:250,interval:5,duration:0,dotSize:12,tooltip:"none"},model:{value:t.vizDetails.maxHeight,callback:function(n){t.$set(t.vizDetails,"maxHeight",n)},expression:"vizDetails.maxHeight"}}),i("p",{staticClass:"speed-label"},[t._v("Hex Radius: "+t._s(t.vizDetails.radius))]),i("vue-slider",{staticClass:"speed-slider",attrs:{min:50,max:1e3,interval:5,duration:0,dotSize:12,tooltip:"none"},model:{value:t.vizDetails.radius,callback:function(n){t.$set(t.vizDetails,"radius",n)},expression:"vizDetails.radius"}})],1)],2):t._e(),!t.thumbnail&&t.myState.statusMessage?i("div",{staticClass:"message"},[i("p",{staticClass:"status-message"},[t._v(t._s(t.myState.statusMessage))])]):t._e()],1)},Et=[];const X={};var Rt=le(Ft,kt,Et,!1,Ht,"196216b2",null,null);function Ht(t){for(let e in X)this[e]=X[e]}var ei=function(){return Rt.exports}();export{ei as default};
//# sourceMappingURL=XyHexagons.0dac629d.js.map
