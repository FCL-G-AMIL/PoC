{"version":3,"file":"VideoPlayer.2c83f106.js","sources":["../../src/plugins/video-player/VideoPlayer.vue","../../src/plugins/video-player/VideoPlayer.vue?vue&type=template&lang.js"],"sourcesContent":["<template lang=\"pug\">\r\n.video-plugin-container(:class=\"{thumbnail}\")\r\n  h3(v-if=\"!thumbnail\") {{ title }}\r\n\r\n  .vid-container\r\n    video(:controls=\"controls\" :loop='loop' :allowfullscreen='allowfullscreen' :autoplay=\"autoplay\" :muted=\"muted\")\r\n      source(v-for=\"(src, type) in sources\" :src=\"src\" :type=\"type\" :key=\"type\")\r\n      p(v-for=\"(src, type) in sources\" :key=\"type\") Video tag not supported. Download the video&nbsp;\r\n        a(:href=\"src\" target=\"_blank\") here\r\n\r\n    //- video-player.vjs-default-skin.vjs-big-play-centered(\r\n    //-   ref=\"videoPlayer\"\r\n    //-   :options=\"playerOptions\"\r\n    //- )\r\n    //- v-if=\"movieSource\"\r\n\r\n</template>\r\n\r\n<script lang=\"ts\">\r\nimport { defineComponent } from 'vue'\r\n\r\n// import { videoPlayer } from 'vue-video-player'\r\n\r\nimport globalStore from '@/store'\r\nimport { FileSystem, FileSystemConfig, VisualizationPlugin } from '@/Globals'\r\nimport HTTPFileSystem from '@/js/HTTPFileSystem'\r\n\r\n// import '~/video.js/dist/video-js.min.css'\r\n\r\nconst MyComponent = defineComponent({\r\n  name: 'VideoPlayerPlugin',\r\n  props: {\r\n    root: { type: String, required: true },\r\n    subfolder: { type: String, required: true },\r\n    yamlConfig: String,\r\n    config: Object,\r\n    thumbnail: Boolean,\r\n  },\r\n\r\n  data: () => {\r\n    return {\r\n      movieSource: '',\r\n      title: '',\r\n      myState: {} as any,\r\n      fileApi: null as FileSystemConfig | null,\r\n      playerOptions: {\r\n        muted: false,\r\n        language: 'en',\r\n        playbackRates: [0.5, 1.0, 1.5, 2.0, 5.0],\r\n        preload: 'metadata',\r\n        responsive: true,\r\n        fluid: false,\r\n        playsInline: true,\r\n        controls: true,\r\n        sources: [] as any[],\r\n      },\r\n    }\r\n  },\r\n\r\n  beforeDestroy() {\r\n    if (!this.thumbnail) globalStore.commit('setFullScreen', false)\r\n  },\r\n\r\n  mounted() {\r\n    this.fileApi = this.getFileSystem(this.root)\r\n\r\n    this.myState = {\r\n      subfolder: this.subfolder,\r\n      yamlConfig: this.yamlConfig,\r\n      thumbnail: this.thumbnail,\r\n      imageData: '',\r\n    }\r\n\r\n    this.playerOptions.fluid = !!this.thumbnail\r\n    if (!this.thumbnail) globalStore.commit('setFullScreen', true)\r\n\r\n    if (!this.yamlConfig) {\r\n      this.buildRouteFromUrl()\r\n    } else {\r\n      this.myState.subfolder = this.subfolder\r\n      this.myState.yamlConfig = this.yamlConfig\r\n      this.buildMovieSource()\r\n    }\r\n\r\n    this.getVizDetails()\r\n  },\r\n  watch: {\r\n    yamlConfig() {\r\n      this.myState.yamlConfig = this.yamlConfig\r\n      this.getVizDetails()\r\n    },\r\n\r\n    subfolder() {\r\n      this.myState.subfolder = this.subfolder\r\n      this.getVizDetails()\r\n    },\r\n  },\r\n  methods: {\r\n    buildMovieSource() {\r\n      this.movieSource = `${this.fileApi?.baseURL}/${this.myState.subfolder}/${this.myState.yamlConfig}`\r\n\r\n      this.playerOptions.sources.push({\r\n        type: 'video/mp4',\r\n        src: this.movieSource,\r\n      })\r\n    },\r\n\r\n    getFileSystem(name: string) {\r\n      const svnProject: FileSystemConfig[] = this.$store.state.svnProjects.filter(\r\n        (a: FileSystemConfig) => a.slug === name\r\n      )\r\n      if (svnProject.length === 0) {\r\n        console.log('no such project')\r\n        throw Error\r\n      }\r\n      return svnProject[0]\r\n    },\r\n\r\n    // this happens if viz is the full page, not a thumbnail on a project page\r\n    async buildRouteFromUrl() {\r\n      const params = this.$route.params\r\n      if (!params.project || !params.pathMatch) {\r\n        console.log('I CANT EVEN: NO PROJECT/PARHMATCH')\r\n        return\r\n      }\r\n\r\n      // project filesystem\r\n      this.fileApi = this.getFileSystem(params.project)\r\n\r\n      // subfolder and config file\r\n      const sep = 1 + params.pathMatch.lastIndexOf('/')\r\n      const subfolder = params.pathMatch.substring(0, sep)\r\n      const config = params.pathMatch.substring(sep)\r\n\r\n      this.myState.subfolder = subfolder\r\n      this.myState.yamlConfig = config\r\n\r\n      this.buildMovieSource()\r\n    },\r\n\r\n    async generateBreadcrumbs() {\r\n      const filesystem = this.getFileSystem(this.$route.params.project)\r\n      if (!filesystem) return []\r\n\r\n      const crumbs = [\r\n        {\r\n          label: filesystem.name,\r\n          url: '/' + filesystem.slug,\r\n        },\r\n      ]\r\n\r\n      const subfolders = this.myState.subfolder.split('/')\r\n      let buildFolder = '/'\r\n      for (const folder of subfolders) {\r\n        if (!folder) continue\r\n\r\n        buildFolder += folder + '/'\r\n        crumbs.push({\r\n          label: folder,\r\n          url: '/' + filesystem.slug + buildFolder,\r\n        })\r\n      }\r\n\r\n      // save them!\r\n      globalStore.commit('setBreadCrumbs', crumbs)\r\n\r\n      return crumbs\r\n    },\r\n\r\n    async getVizDetails() {\r\n      this.title = this.myState.yamlConfig.replace(/_/g, ' ')\r\n      this.title = this.title.substring(0, this.title.lastIndexOf('.'))\r\n\r\n      if (this.title) {\r\n        this.$emit('title', this.title)\r\n      }\r\n    },\r\n  },\r\n})\r\n\r\nexport default MyComponent\r\n</script>\r\n\r\n<style>\r\n.video-js {\r\n  position: absolute;\r\n  width: 100%;\r\n  height: auto;\r\n  top: 0;\r\n  right: 0;\r\n  bottom: 0;\r\n  left: 0;\r\n  margin: auto 0;\r\n  background-color: #223;\r\n}\r\n</style>\r\n\r\n<style scoped lang=\"scss\">\r\n.video-plugin-container {\r\n  display: flex;\r\n  flex-direction: column;\r\n  background-color: #223;\r\n  padding: 0 20px 20px 20px;\r\n  position: relative;\r\n}\r\n\r\n.thumbnail {\r\n  height: 11rem;\r\n  // z-index: -1;\r\n  padding: 0 0;\r\n}\r\n\r\n.vid-container {\r\n  width: 100%;\r\n  height: 100%;\r\n  position: relative;\r\n}\r\n\r\n.thumbnail .vid-container {\r\n  position: absolute;\r\n  top: 50%;\r\n  left: 50%;\r\n  transform: translate(-50%, -50%);\r\n  overflow: hidden;\r\n}\r\n\r\nh3 {\r\n  color: #ccc;\r\n  padding: 0.5rem 0;\r\n  text-align: center;\r\n}\r\n</style>\r\n","\r\n.video-plugin-container(:class=\"{thumbnail}\")\r\n  h3(v-if=\"!thumbnail\") {{ title }}\r\n\r\n  .vid-container\r\n    video(:controls=\"controls\" :loop='loop' :allowfullscreen='allowfullscreen' :autoplay=\"autoplay\" :muted=\"muted\")\r\n      source(v-for=\"(src, type) in sources\" :src=\"src\" :type=\"type\" :key=\"type\")\r\n      p(v-for=\"(src, type) in sources\" :key=\"type\") Video tag not supported. Download the video&nbsp;\r\n        a(:href=\"src\" target=\"_blank\") here\r\n\r\n    //- video-player.vjs-default-skin.vjs-big-play-centered(\r\n    //-   ref=\"videoPlayer\"\r\n    //-   :options=\"playerOptions\"\r\n    //- )\r\n    //- v-if=\"movieSource\"\r\n\r\n"],"names":["MyComponent","defineComponent","globalStore","_a","name","svnProject","a","params","sep","subfolder","config","filesystem","crumbs","subfolders","buildFolder","folder","render","_vm","_h","_c","src","type","staticRenderFns"],"mappings":"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"}