import{d as h,g as d,U as c,B as r,S as u,n as g}from"./index.1d7144b8.js";import{V as f}from"./VuePlotly.a136978d.js";import{b as m}from"./DashBoard.c40bb82f.js";import"./index.d10190c4.js";import"./HTTPFileSystem.33aea9ff.js";import"./TopSheet.f44901df.js";var p=h({name:"BubbleChartPanel",components:{VuePlotly:f},props:{fileSystemConfig:{type:Object,required:!0},subfolder:{type:String,required:!0},files:{type:Array,required:!0},config:{type:Object,required:!0},cardTitle:{type:String,required:!0},datamanager:{type:Object,required:!0},cardId:String},data:()=>({globalState:d.state,dataSet:{},id:"bubble-"+Math.floor(1e12*Math.random()),layout:{height:300,margin:{t:8,b:0,l:0,r:0,pad:2},font:{color:"#444444",family:c},xaxis:{automargin:!0,autorange:!0,title:{text:"",standoff:12},animate:!0},yaxis:{automargin:!0,autorange:!0,title:{text:"",standoff:16},animate:!0},legend:{orientation:"v",x:1,y:1}},data:[],options:{displaylogo:!1,responsive:!0,modeBarButtonsToRemove:["pan2d","zoom2d","select2d","lasso2d","zoomIn2d","zoomOut2d","autoScale2d","hoverClosestCartesian","hoverCompareCartesian","resetScale2d","toggleSpikelines","resetViewMapbox"],toImageButtonOptions:{format:"png",filename:"bubble-chart",width:null,height:null}}}),async mounted(){this.updateTheme(),this.options.toImageButtonOptions.filename=m(this.cardTitle,this.subfolder),this.dataSet=await this.loadData(),this.updateChart(),this.$emit("dimension-resizer",{id:this.cardId,resizer:this.changeDimensions}),this.$emit("isLoaded")},beforeDestroy(){var t;(t=this.datamanager)==null||t.removeFilterListener(this.config,this.handleFilterChanged)},watch:{"globalState.isDarkMode"(){this.updateTheme()}},methods:{changeDimensions(t){this.layout=Object.assign({},this.layout,t)},updateTheme(){const t={paper_bgcolor:r[this.globalState.colorScheme],plot_bgcolor:r[this.globalState.colorScheme],font:{color:this.globalState.isDarkMode?"#cccccc":"#444444"}};this.layout=Object.assign({},this.layout,t)},async loadData(){if(!this.datamanager)return{};try{let t=await this.datamanager.getDataset(this.config);if(!this.config.filters)return t;this.datamanager.addFilterListener(this.config,this.handleFilterChanged);for(const[e,a]of Object.entries(this.config.filters)){const i={dataset:this.config.dataset,column:e,value:a,range:Array.isArray(a)};this.datamanager.setFilter(i)}return{allRows:{}}}catch(t){console.error(""+t)}return{allRows:{}}},handleFilterChanged(){if(!this.datamanager)return;const{filteredRows:t}=this.datamanager.getFilteredDataset(this.config);if(!t||!t.length)this.dataSet={allRows:{}};else{const e={},a=Object.keys(t[0]);a.forEach(i=>e[i]={name:i,values:[]}),t.forEach(i=>{a.forEach(s=>e[s].values.push(i[s]))}),this.dataSet={allRows:e}}this.updateChart()},updateChart(){this.layout.xaxis.title.text=this.config.xAxisTitle||this.config.xAxisName||"",this.layout.yaxis.title.text=this.config.yAxisTitle||this.config.yAxisName||"";try{this.config.groupBy?this.updateChartWithGroupBy():this.updateChartSimple()}catch(t){const e=""+t;this.$store.commit("setStatus",{type:u.ERROR,msg:e,desc:"Add a desription..."})}},updateChartWithGroupBy(){},updateChartSimple(){const t=this.config.factor||1;var e=this.config.bubble;this.config.legendName&&(e=this.config.legendName),this.config.legendTitle&&(e=this.config.legendTitle);const a=this.dataSet.allRows||{};if(Object.keys(a).length===0)return;let i=a[this.config.bubble].values.map(l=>l*t);this.config.skipFirstRow&&(i=i.slice(1));let s=a[this.config.x].values||[];this.config.skipFirstRow&&(s=s.slice(1));let o=a[this.config.y].values;this.config.skipFirstRow&&(o=o.slice(1)),this.data=[{x:s,y:o,name:e,mode:"markers",type:"scatter",textinfo:"label+percent",textposition:"inside",automargin:!0,showlegend:!0,marker:{size:i}}]}}}),b=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("VuePlotly",{staticClass:"yplot",attrs:{data:t.data,layout:t.layout,options:t.options,id:t.id}})},y=[];const n={};var _=g(p,b,y,!1,v,"7d62fe88",null,null);function v(t){for(let e in n)this[e]=n[e]}var F=function(){return _.exports}();export{F as default};
//# sourceMappingURL=bubble.f1d6b043.js.map
