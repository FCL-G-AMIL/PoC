{"version":3,"file":"EventViewer.c97200e9.js","sources":["../../src/plugins/event-viewer/EventDeckMap.tsx","../../src/plugins/event-viewer/EventViewer.vue","../../src/plugins/event-viewer/EventViewer.vue?vue&type=template&lang.js"],"sourcesContent":["import React, { useState, useMemo, useEffect } from 'react'\r\nimport DeckGL from '@deck.gl/react'\r\nimport { StaticMap } from 'react-map-gl'\r\nimport { ScatterplotLayer } from '@deck.gl/layers'\r\nimport { DataFilterExtension } from '@deck.gl/extensions'\r\nimport * as timeConvert from 'convert-seconds'\r\n\r\nimport { REACT_VIEW_HANDLES, MAPBOX_TOKEN } from '@/Globals'\r\nimport ScatterplotColorBinsLayer from '@/plugins/xy-time/ScatterplotColorBinsLayer'\r\nimport MovingIconsLayer from '@/layers/moving-icons/moving-icons-vehicles-layer'\r\nimport globalStore from '@/store'\r\nimport { NetworkLinks } from '@/js/DashboardDataManager'\r\n\r\nconst BASE_URL = import.meta.env.BASE_URL\r\n\r\nconst ICON_MAPPING = {\r\n  marker: { x: 0, y: 0, width: 128, height: 128, mask: true },\r\n  info: { x: 128, y: 0, width: 128, height: 128, mask: true },\r\n  vehicle: { x: 128, y: 128, width: 128, height: 128, mask: true },\r\n  diamond: { x: 0, y: 128, width: 128, height: 128, mask: false },\r\n}\r\n\r\nconst dataFilter = new DataFilterExtension({ filterSize: 1 })\r\n\r\nfunction convertSecondsToClockTimeMinutes(index: number) {\r\n  const seconds = index\r\n\r\n  try {\r\n    const hms = timeConvert(seconds)\r\n    const minutes = ('00' + hms.minutes).slice(-2)\r\n    return `${hms.hours}:${minutes}`\r\n  } catch (e) {\r\n    return '00:00'\r\n  }\r\n}\r\n\r\nconst INITIAL_VIEW = {\r\n  pitch: 0,\r\n  zoom: 8,\r\n  bearing: 0,\r\n  longitude: 14,\r\n  latitude: 52.0,\r\n  // longitude: 14.38,\r\n  // latitude: 51.7,\r\n}\r\n\r\n// -------------------------------------------------------------------\r\nexport default function Component({\r\n  viewId = 0,\r\n  eventLayers = [] as any[],\r\n  network = {} as NetworkLinks,\r\n  linkIdLookup = {} as any,\r\n  timeFilter = [] as number[],\r\n  dark = false,\r\n  colors = [\r\n    [1, 0, 0],\r\n    [0.25, 0.25, 1],\r\n  ] as number[][],\r\n  breakpoints = [0.0] as number[],\r\n  radius = 5,\r\n  mapIsIndependent = false,\r\n  simulationTime = 20000,\r\n}) {\r\n  // manage SimWrapper centralized viewState - for linked maps\r\n  const [viewState, setViewState] = useState(INITIAL_VIEW)\r\n\r\n  REACT_VIEW_HANDLES[viewId] = () => {\r\n    setViewState(globalStore.state.viewState)\r\n  }\r\n\r\n  function handleViewState(view: any) {\r\n    if (!view.latitude) return\r\n\r\n    if (!view.center) view.center = [0, 0]\r\n    view.center[0] = view.longitude\r\n    view.center[1] = view.latitude\r\n    setViewState(view)\r\n\r\n    if (!mapIsIndependent) globalStore.commit('setMapCamera', view)\r\n  }\r\n\r\n  function getTooltip(element: any) {\r\n    // console.log(element)\r\n    if (element.index < 0) return null\r\n\r\n    return 'hi'\r\n\r\n    // const layerId = element?.layer?.id\r\n    // if (layerId === undefined) return null\r\n\r\n    // const time = pointLayers[layerId].time[element.index]\r\n    // const humanTime = convertSecondsToClockTimeMinutes(time)\r\n\r\n    // const value = pointLayers[layerId].value[element.index]\r\n    // const cleanValue = Math.round(1e6 * value) / 1e6\r\n    // return {\r\n    //   html: `\\\r\n    //     <table style=\"font-size: 0.9rem\">\r\n    //     <tr>\r\n    //       <td>Value</td>\r\n    //       <td style=\"padding-left: 0.5rem;\"><b>${cleanValue}</b></td>\r\n    //     </tr><tr>\r\n    //       <td style=\"text-align: right;\">Time</td>\r\n    //       <td style=\"padding-left: 0.5rem;\"><b>${humanTime}</b></td>\r\n    //     </tr>\r\n    //     </table>\r\n    //   `,\r\n    //   style: dark\r\n    //     ? { color: '#ccc', backgroundColor: '#2a3c4f' }\r\n    //     : { color: '#223', backgroundColor: 'white' },\r\n    // }\r\n  }\r\n\r\n  // add a scatterplotlayer for each set of points in eventLayers\r\n  const pointLayers = eventLayers.map((layer, layerIndex) => {\r\n    // The entire layer can be hidden if all of its points\r\n    // are beyond the timeFilter range that is being shown.\r\n    const outOfRange =\r\n      layer.times[0] > timeFilter[1] || layer.times[layer.times.length - 1] < timeFilter[0]\r\n\r\n    return new ScatterplotLayer({\r\n      data: {\r\n        length: layer.times.length,\r\n        attributes: {\r\n          getFilterValue: { value: layer.times, size: 1 },\r\n          getPosition: { value: layer.positions, size: 2 },\r\n        },\r\n      },\r\n      autoHighlight: true,\r\n      breakpoints: breakpoints,\r\n      colors: colors,\r\n      extensions: [dataFilter],\r\n      id: 'hello' + layerIndex,\r\n      filled: true,\r\n      filterRange: timeFilter.length ? timeFilter : null,\r\n      getRadius: 20,\r\n      getFillColor: [240, 128, 10],\r\n      highlightColor: [255, 0, 224],\r\n      opacity: 1,\r\n      parameters: { depthTest: false },\r\n      pickable: true,\r\n      radiusScale: 1,\r\n      stroked: false,\r\n      updateTriggers: {\r\n        getPosition: eventLayers,\r\n        //   // getFillColor: pointLayers,\r\n        getFilterValue: timeFilter,\r\n      },\r\n      // transitions: {\r\n      //   getFillColor: 500,\r\n      //   getColor: 500,\r\n      //   getValue: 500,\r\n      //   getFilterValue: 500,\r\n      // },\r\n      // hide layers that are entirely outside the time window filter:\r\n      visible: !outOfRange,\r\n    })\r\n  })\r\n\r\n  // add the vehicle motion layer in each eventLayer\r\n  const vehicleLayers = eventLayers.map((layer, layerIndex) => {\r\n    // The entire layer can be hidden if all of its points\r\n    // are beyond the timeFilter range that is being shown.\r\n    const outOfRange =\r\n      layer.vehicles.t0[0] > timeFilter[1] ||\r\n      layer.vehicles.t1[layer.vehicles.t1.length - 1] < timeFilter[0]\r\n\r\n    // console.log(outOfRange)\r\n    //@ts-ignore\r\n    return new MovingIconsLayer({\r\n      data: {\r\n        length: layer.vehicles.t0.length,\r\n        attributes: {\r\n          getTimeStart: { value: layer.vehicles.t0, size: 1 },\r\n          getTimeEnd: { value: layer.vehicles.t1, size: 1 },\r\n          getPathStart: { value: layer.vehicles.locO, size: 2 },\r\n          getPathEnd: { value: layer.vehicles.locD, size: 2 },\r\n        },\r\n      },\r\n      id: 'vehicles' + layerIndex,\r\n      // getIcon: (d: any) => 'vehicle',\r\n      getColor: [64, 96, 255], // (d: any) => props.colors[d.occ],\r\n      iconMoving: 'vehicle',\r\n      iconStill: 'diamond',\r\n      getSize: 20, // searchEnabled ? 56 : 44,\r\n      opacity: 1.0,\r\n      currentTime: simulationTime,\r\n      shadowEnabled: true,\r\n      iconAtlas: BASE_URL + '/images/icon-atlas.png',\r\n      iconMapping: ICON_MAPPING,\r\n      sizeScale: 1,\r\n      billboard: false,\r\n      pickable: true,\r\n      depthTest: true,\r\n      autoHighlight: false,\r\n      highlightColor: [255, 0, 255],\r\n      // onHover: setHoverInfo,\r\n      parameters: {\r\n        depthTest: false,\r\n      },\r\n      visible: !outOfRange,\r\n    })\r\n  })\r\n\r\n  const allLayers = [...pointLayers, ...vehicleLayers]\r\n\r\n  // initialViewState={initialViewState}\r\n  return (\r\n    <DeckGL\r\n      layers={allLayers}\r\n      controller={true}\r\n      useDevicePixels={true}\r\n      viewState={viewState}\r\n      onViewStateChange={(e: any) => handleViewState(e.viewState)}\r\n      pickingRadius={4}\r\n      onClick={getTooltip}\r\n      getTooltip={getTooltip}\r\n    >\r\n      {\r\n        /*\r\n        // @ts-ignore */\r\n        <StaticMap\r\n          mapStyle={globalStore.getters.mapStyle}\r\n          preventStyleDiffing={true}\r\n          mapboxApiAccessToken={MAPBOX_TOKEN}\r\n        />\r\n      }\r\n    </DeckGL>\r\n  )\r\n}\r\n","<template lang=\"pug\">\r\n.viz-plugin(oncontextmenu=\"return false\" :id=\"`id-${viewId}`\")\r\n\r\n  event-map.map-layer(v-if=\"!thumbnail && isLoaded\"\r\n    :viewId=\"viewId\"\r\n    :eventLayers=\"eventLayers\"\r\n    :network=\"network\"\r\n    :linkIdLookup=\"linkIdLookup\"\r\n    :timeFilter=\"timeFilter\"\r\n    :dark=\"this.$store.state.isDarkMode\"\r\n    :colors=\"this.colors\"\r\n    :breakpoints=\"this.breakpoints\"\r\n    :radius=\"this.guiConfig.radius\"\r\n    :mapIsIndependent=\"false\"\r\n    :simulationTime=\"timeFilter[1]\"\r\n  )\r\n\r\n  zoom-buttons(v-if=\"!thumbnail\" corner=\"bottom\")\r\n\r\n  .top-right\r\n    .gui-config(:id=\"configId\")\r\n\r\n  .bottom-right\r\n    .legend-area(v-if=\"legendStore\")\r\n      legend-box(:legendStore=\"legendStore\")\r\n\r\n  time-slider.time-slider-area(v-if=\"isLoaded\"\r\n    :range=\"timeRange\"\r\n    :activeTimeExtent=\"timeFilter\"\r\n    :labels=\"timeLabels\"\r\n    :isAnimating=\"isAnimating\"\r\n    @timeExtent=\"handleTimeSliderValues\"\r\n    @toggleAnimation=\"toggleAnimation\"\r\n    @drag=\"isAnimating=false\"\r\n  )\r\n\r\n  .message(v-if=\"!thumbnail && myState.statusMessage\")\r\n    p.status-message {{ myState.statusMessage }}\r\n\r\n</template>\r\n\r\n<script lang=\"ts\">\r\nconst i18n = {\r\n  messages: {\r\n    en: {\r\n      loading: 'Loading data...',\r\n      sorting: 'Sorting into bins...',\r\n      aggregate: 'Summary',\r\n      maxHeight: '3D Height',\r\n      showDetails: 'Show Details',\r\n      selection: 'Selection',\r\n      areas: 'Areas',\r\n      count: 'Count',\r\n      promptCRS: `Enter the coordinate reference system, e.g. EPSG:25832\\n\\nThese coordinates are not in long/lat format. To fix this permanently, convert them to long/lat or add \"# EPSG:xxxx\" to your CSV header`,\r\n    },\r\n    de: {\r\n      loading: 'Dateien laden...',\r\n      sorting: 'Sortieren...',\r\n      aggregate: 'Daten',\r\n      maxHeight: '3-D Höhe',\r\n      showDetails: 'Details anzeigen',\r\n      selection: 'Ausgewählt',\r\n      areas: 'Orte',\r\n      count: 'Anzahl',\r\n    },\r\n  },\r\n}\r\n\r\nimport { defineComponent } from 'vue'\r\nimport type { PropType } from 'vue'\r\n\r\nimport GUI from 'lil-gui'\r\nimport YAML from 'yaml'\r\nimport colormap from 'colormap'\r\n\r\nimport util from '@/js/util'\r\nimport globalStore from '@/store'\r\nimport CollapsiblePanel from '@/components/CollapsiblePanel.vue'\r\nimport DrawingTool from '@/components/DrawingTool/DrawingTool.vue'\r\nimport HTTPFileSystem from '@/js/HTTPFileSystem'\r\nimport LegendBox from '@/components/viz-configurator/LegendBox.vue'\r\nimport LegendStore from '@/js/LegendStore'\r\nimport TimeSlider from '@/components/TimeSlider.vue'\r\nimport EventMap from './EventDeckMap'\r\nimport ZoomButtons from '@/components/ZoomButtons.vue'\r\n\r\nimport MATSimEventStreamer from '@/workers/MATSimEventStreamer.worker.ts?worker'\r\n\r\nimport {\r\n  ColorScheme,\r\n  FileSystem,\r\n  LegendItem,\r\n  LegendItemType,\r\n  FileSystemConfig,\r\n  VisualizationPlugin,\r\n  Status,\r\n  REACT_VIEW_HANDLES,\r\n} from '@/Globals'\r\nimport DashboardDataManager, { NetworkLinks } from '@/js/DashboardDataManager'\r\n\r\ninterface VizDetail {\r\n  title: string\r\n  description?: string\r\n  file: string\r\n  projection: any\r\n  thumbnail?: string\r\n  center: any\r\n  zoom: number\r\n}\r\n\r\ninterface PointLayer {\r\n  color: Uint8Array\r\n  value: Float32Array\r\n  coordinates: Float32Array\r\n  time: Float32Array\r\n  timeRange: number[]\r\n}\r\n\r\nconst MyComponent = defineComponent({\r\n  name: 'EventViewerPlugin',\r\n  i18n,\r\n  components: {\r\n    CollapsiblePanel,\r\n    DrawingTool,\r\n    EventMap,\r\n    LegendBox,\r\n    TimeSlider,\r\n    ZoomButtons,\r\n  },\r\n  props: {\r\n    root: { type: String, required: true },\r\n    subfolder: { type: String, required: true },\r\n    yamlConfig: String,\r\n    config: Object as any,\r\n    thumbnail: Boolean,\r\n    datamanager: { type: Object as PropType<DashboardDataManager> },\r\n  },\r\n  data: () => {\r\n    const colorRamps = ['bathymetry', 'electric', 'inferno', 'jet', 'magma', 'par', 'viridis']\r\n\r\n    return {\r\n      myDataManager: null as DashboardDataManager | null,\r\n      network: {\r\n        source: new Float32Array(),\r\n        dest: new Float32Array(),\r\n        linkIds: [],\r\n      } as NetworkLinks,\r\n      linkIdLookup: {} as any,\r\n      guiConfig: {\r\n        buckets: 7,\r\n        exponent: 4,\r\n        radius: 5,\r\n        'clip max': 100,\r\n        'color ramp': 'viridis',\r\n        flip: false,\r\n        colorRamps: colorRamps,\r\n      },\r\n      viewId: ('xyt-id-' + Math.floor(1e12 * Math.random())) as any,\r\n      configId: ('gui-config-' + Math.floor(1e12 * Math.random())) as any,\r\n      timeLabels: [0, 1] as any[],\r\n      startTime: 0,\r\n      isAnimating: false,\r\n      timeFilter: [0, 3599],\r\n      colors: [\r\n        [128, 128, 128],\r\n        [128, 128, 128],\r\n      ] as number[][],\r\n      breakpoints: [0],\r\n      range: [Infinity, -Infinity],\r\n      timeRange: [Infinity, -Infinity],\r\n      legendStore: null as LegendStore | null,\r\n      standaloneYAMLconfig: {\r\n        title: '',\r\n        description: '',\r\n        file: '',\r\n        projection: '',\r\n        thumbnail: '',\r\n        radius: 250,\r\n        maxHeight: 0,\r\n        center: null as any,\r\n        zoom: 9,\r\n      } as any,\r\n      YAMLrequirementsXY: { file: '' },\r\n      columnLookup: [] as number[],\r\n      gzipWorker: null as Worker | null,\r\n      vizDetails: {\r\n        title: '',\r\n        description: '',\r\n        file: '',\r\n        projection: '',\r\n        thumbnail: '',\r\n        center: null as any,\r\n        zoom: 9,\r\n      } as VizDetail,\r\n      myState: {\r\n        statusMessage: '',\r\n        subfolder: '',\r\n        yamlConfig: '',\r\n        thumbnail: false,\r\n      },\r\n      eventLayers: [] as any[],\r\n      isLoaded: false,\r\n      animator: null as any,\r\n      guiController: null as GUI | null,\r\n      resizer: null as ResizeObserver | null,\r\n      thumbnailUrl: \"url('assets/thumbnail.jpg') no-repeat;\",\r\n      ANIMATE_SPEED: 0.25,\r\n      animationElapsedTime: 0,\r\n      animationClockTime: 0,\r\n    }\r\n  },\r\n  computed: {\r\n    fileApi(): HTTPFileSystem {\r\n      return new HTTPFileSystem(this.fileSystem, globalStore)\r\n    },\r\n\r\n    fileSystem(): FileSystemConfig {\r\n      const svnProject: FileSystemConfig[] = this.$store.state.svnProjects.filter(\r\n        (a: FileSystemConfig) => a.slug === this.root\r\n      )\r\n      if (svnProject.length === 0) {\r\n        console.log('no such project')\r\n        throw Error\r\n      }\r\n      return svnProject[0]\r\n    },\r\n    urlThumbnail(): any {\r\n      return this.thumbnailUrl\r\n    },\r\n  },\r\n  watch: {\r\n    '$store.state.viewState'() {\r\n      if (REACT_VIEW_HANDLES[this.viewId]) REACT_VIEW_HANDLES[this.viewId]()\r\n    },\r\n  },\r\n  methods: {\r\n    handleTimeSliderValues(timeValues: any[]) {\r\n      this.animationElapsedTime = timeValues[0]\r\n      this.timeFilter = timeValues\r\n      this.timeLabels = [\r\n        this.convertSecondsToClockTimeMinutes(timeValues[0]),\r\n        this.convertSecondsToClockTimeMinutes(timeValues[1]),\r\n      ]\r\n    },\r\n\r\n    setupLogoMover() {\r\n      this.resizer = new ResizeObserver(this.moveLogo)\r\n      const deckmap = document.getElementById(`id-${this.viewId}`) as HTMLElement\r\n      this.resizer.observe(deckmap)\r\n    },\r\n\r\n    moveLogo() {\r\n      const deckmap = document.getElementById(`${this.viewId}`) as HTMLElement\r\n      const logo = deckmap?.querySelector('.mapboxgl-ctrl-bottom-left') as HTMLElement\r\n      if (logo) {\r\n        const right = deckmap.clientWidth > 640 ? '280px' : '36px'\r\n        logo.style.right = right\r\n      }\r\n    },\r\n\r\n    setupGui() {\r\n      this.guiController = new GUI({\r\n        title: 'Color Settings',\r\n        injectStyles: true,\r\n        width: 200,\r\n        container: document.getElementById(this.configId) || undefined,\r\n      })\r\n\r\n      const colors = this.guiController // .addFolder('Colors')\r\n      colors.add(this.guiConfig, 'buckets', 2, 19, 1).onChange(this.setColors)\r\n      colors.add(this.guiConfig, 'exponent', 1, 10, 1).onChange(this.setColors)\r\n      colors.add(this.guiConfig, 'clip max', 0, 100, 1).onChange(this.setColors)\r\n      colors.add(this.guiConfig, 'radius', 1, 20, 1)\r\n      colors.add(this.guiConfig, 'color ramp', this.guiConfig.colorRamps).onChange(this.setColors)\r\n      colors.add(this.guiConfig, 'flip').onChange(this.setColors)\r\n\r\n      // const times = this.guiController.addFolder('Time')\r\n    },\r\n\r\n    async solveProjection() {\r\n      if (this.thumbnail) return\r\n\r\n      console.log('WHAT PROJECTION:')\r\n\r\n      try {\r\n        const text = await this.fileApi.getFileText(\r\n          this.myState.subfolder + '/' + this.myState.yamlConfig\r\n        )\r\n        this.vizDetails = YAML.parse(text)\r\n      } catch (e) {\r\n        console.error(e)\r\n      }\r\n    },\r\n\r\n    async getVizDetails() {\r\n      if (this.config) {\r\n        this.validateYAML()\r\n        this.vizDetails = Object.assign({}, this.config)\r\n        return\r\n      }\r\n\r\n      const hasYaml = new RegExp('.*(yml|yaml)$').test(this.myState.yamlConfig)\r\n\r\n      if (hasYaml) {\r\n        await this.loadStandaloneYAMLConfig()\r\n      } else {\r\n        // console.log('NO YAML WTF')\r\n        this.setConfigForRawCSV()\r\n      }\r\n    },\r\n\r\n    setConfigForRawCSV() {\r\n      let projection = 'EPSG:4326' // Include \"# EPSG:xxx\" in header of CSV to set EPSG\r\n\r\n      // output_trips:\r\n      this.vizDetails = {\r\n        title: 'EVENTS: ' + this.myState.yamlConfig,\r\n        description: this.myState.yamlConfig,\r\n        file: this.myState.yamlConfig,\r\n        projection,\r\n        center: this.vizDetails.center,\r\n        zoom: this.vizDetails.zoom,\r\n      }\r\n      this.$emit('title', this.vizDetails.title || this.vizDetails.file)\r\n      return\r\n    },\r\n\r\n    async loadStandaloneYAMLConfig() {\r\n      if (!this.fileApi) return\r\n      try {\r\n        // might be a project config:\r\n        const filename =\r\n          this.myState.yamlConfig.indexOf('/') > -1\r\n            ? this.myState.yamlConfig\r\n            : this.myState.subfolder + '/' + this.myState.yamlConfig\r\n\r\n        const text = await this.fileApi.getFileText(filename)\r\n        this.standaloneYAMLconfig = Object.assign({}, YAML.parse(text))\r\n        this.validateYAML()\r\n        this.setVizDetails()\r\n      } catch (err) {\r\n        const e = err as any\r\n        console.log('failed')\r\n\r\n        this.$store.commit('setStatus', {\r\n          type: Status.ERROR,\r\n          msg: `File not found`,\r\n          desc: `Could not find: ${this.myState.subfolder}/${this.myState.yamlConfig}`,\r\n        })\r\n      }\r\n    },\r\n\r\n    validateYAML() {\r\n      const hasYaml = new RegExp('.*(yml|yaml)$').test(this.myState.yamlConfig)\r\n      let configuration\r\n\r\n      if (hasYaml) {\r\n        console.log('has yaml')\r\n        configuration = this.standaloneYAMLconfig\r\n      } else {\r\n        console.log('no yaml')\r\n        configuration = this.config\r\n      }\r\n\r\n      for (const key in this.YAMLrequirementsXY) {\r\n        if (key in configuration === false) {\r\n          this.$store.commit('setStatus', {\r\n            type: Status.ERROR,\r\n            msg: `YAML file missing required key: ${key}`,\r\n            desc: 'Check this.YAMLrequirementsXY for required keys',\r\n          })\r\n        }\r\n      }\r\n\r\n      if (configuration.radius == 0) {\r\n        this.$store.commit('setStatus', {\r\n          type: Status.WARNING,\r\n          msg: `Radius set to zero`,\r\n          desc: 'Radius can not be zero, preset value used instead. ',\r\n        })\r\n      }\r\n\r\n      if (configuration.zoom < 5 || configuration.zoom > 20) {\r\n        this.$store.commit('setStatus', {\r\n          type: Status.WARNING,\r\n          msg: `Zoom is out of the recommended range `,\r\n          desc: 'Zoom levels should be between 5 and 20. ',\r\n        })\r\n      }\r\n    },\r\n\r\n    setVizDetails() {\r\n      this.vizDetails = Object.assign({}, this.vizDetails, this.standaloneYAMLconfig)\r\n\r\n      const t = this.vizDetails.title ? this.vizDetails.title : 'EVENTS: ' + this.vizDetails.file\r\n      this.$emit('title', t)\r\n    },\r\n    async buildThumbnail() {\r\n      if (this.thumbnail && this.vizDetails.thumbnail) {\r\n        try {\r\n          const blob = await this.fileApi.getFileBlob(\r\n            this.myState.subfolder + '/' + this.vizDetails.thumbnail\r\n          )\r\n          const buffer = await blob.arrayBuffer()\r\n          const base64 = util.arrayBufferToBase64(buffer)\r\n          if (base64)\r\n            this.thumbnailUrl = `center / cover no-repeat url(data:image/png;base64,${base64})`\r\n        } catch (e) {\r\n          console.error(e)\r\n        }\r\n      }\r\n    },\r\n\r\n    async streamEventFile(filename: string) {\r\n      this.myState.statusMessage = 'Loading file...'\r\n      let totalRows = 0\r\n      this.range = [Infinity, -Infinity]\r\n      this.timeRange = [Infinity, -Infinity]\r\n      this.animationElapsedTime = 0\r\n      this.timeFilter = [0, 59]\r\n\r\n      // get the raw unzipped arraybuffer\r\n      if (this.gzipWorker) this.gzipWorker.terminate()\r\n      this.eventLayers = []\r\n      this.gzipWorker = new MATSimEventStreamer()\r\n\r\n      const formatter = Intl.NumberFormat()\r\n\r\n      this.gzipWorker.onmessage = async (event: MessageEvent) => {\r\n        const message = event.data\r\n        if (message.status) {\r\n          this.myState.statusMessage = message.status\r\n        } else if (message.error) {\r\n          this.myState.statusMessage = message.error\r\n          this.$store.commit('setStatus', {\r\n            type: Status.ERROR,\r\n            msg: `XYT Loading Error`,\r\n            desc: `Error loading: ${this.myState.subfolder}/${this.vizDetails.file}`,\r\n          })\r\n        } else if (message.finished) {\r\n          this.finishedLoadingData(totalRows, message)\r\n        } else {\r\n          const events = message.events as any[]\r\n\r\n          console.log(events.length)\r\n\r\n          totalRows += events.length\r\n          this.myState.statusMessage = 'Loading ' + formatter.format(totalRows) + ' events'\r\n\r\n          // minmax all events\r\n          this.timeRange = [\r\n            Math.min(this.timeRange[0], events[0].time),\r\n            Math.max(this.timeRange[1], events[events.length - 1].time),\r\n          ]\r\n\r\n          // minmax vehicle trips specifically\r\n          this.timeRange = [\r\n            Math.min(this.timeRange[0], message.vehicleTrips[0].t0),\r\n            Math.max(this.timeRange[1], message.vehicleTrips[message.vehicleTrips.length - 1].t1),\r\n          ]\r\n\r\n          // .filter(row => row.link)\r\n          const linkEvents = events.map(row => {\r\n            return {\r\n              time: row.time,\r\n              link: row.link,\r\n            } as any\r\n          })\r\n\r\n          // POSITIONS ----\r\n          const positions = new Float32Array(2 * linkEvents.length).fill(NaN)\r\n          for (let i = 0; i < linkEvents.length; i++) {\r\n            const offset = 2 * this.linkIdLookup[linkEvents[i].link]\r\n            positions[i * 2] = this.network.source[offset]\r\n            positions[i * 2 + 1] = this.network.source[offset + 1]\r\n          }\r\n\r\n          // VEHICLES -----------\r\n          const numTrips = message.vehicleTrips.length\r\n          const tripData = {\r\n            locO: new Float32Array(2 * numTrips).fill(NaN),\r\n            locD: new Float32Array(2 * numTrips).fill(NaN),\r\n            t0: new Float32Array(numTrips).fill(NaN),\r\n            t1: new Float32Array(numTrips).fill(NaN),\r\n          }\r\n\r\n          for (let i = 0; i < numTrips; i++) {\r\n            const trip = message.vehicleTrips[i]\r\n            const offset = 2 * this.linkIdLookup[trip.link]\r\n            tripData.locO[i * 2 + 0] = this.network.source[0 + offset]\r\n            tripData.locO[i * 2 + 1] = this.network.source[1 + offset]\r\n            tripData.locD[i * 2 + 0] = this.network.dest[0 + offset]\r\n            tripData.locD[i * 2 + 1] = this.network.dest[1 + offset]\r\n            // enter/leave traffic happen in the middle of the link\r\n            if (i == 0) {\r\n              tripData.locO[i * 2 + 0] = 0.5 * (tripData.locO[i * 2 + 0] + tripData.locD[i * 2 + 0])\r\n              tripData.locO[i * 2 + 1] = 0.5 * (tripData.locO[i * 2 + 1] + tripData.locD[i * 2 + 1])\r\n            } else if (i == numTrips - 1) {\r\n              tripData.locD[i * 2 + 0] = 0.5 * (tripData.locO[i * 2 + 0] + tripData.locD[i * 2 + 0])\r\n              tripData.locD[i * 2 + 1] = 0.5 * (tripData.locO[i * 2 + 1] + tripData.locD[i * 2 + 1])\r\n            }\r\n            tripData.t0[i] = trip.t0\r\n            tripData.t1[i] = trip.t1\r\n          }\r\n\r\n          // ALL DONE --------\r\n\r\n          this.eventLayers.push({\r\n            events: events.slice(1, 2), // linkEvents.slice(1, 2),\r\n            positions,\r\n            vehicles: tripData,\r\n            times: message.times,\r\n          })\r\n\r\n          // zoom map on first load\r\n          // if (!totalRows) this.setFirstZoom(message.coordinates, rows)\r\n          // // save layer data\r\n          // totalRows += rows\r\n        }\r\n      }\r\n\r\n      this.gzipWorker.postMessage({\r\n        filePath: filename,\r\n        fileSystem: this.fileSystem,\r\n        projection: this.vizDetails.projection,\r\n      })\r\n    },\r\n\r\n    setFirstZoom(coordinates: any[], rows: number) {\r\n      const longitude = 0.5 * (coordinates[0] + coordinates[rows * 2 - 2])\r\n      const latitude = 0.5 * (coordinates[1] + coordinates[rows * 2 - 1])\r\n\r\n      if (Number.isFinite(longitude) && Number.isFinite(latitude)) {\r\n        globalStore.commit(\r\n          'setMapCamera',\r\n          Object.assign({}, globalStore.state.viewState, { longitude, latitude, zoom: 10 })\r\n        )\r\n      }\r\n    },\r\n\r\n    finishedLoadingData(totalRows: number, data: any) {\r\n      this.isLoaded = true\r\n      this.range = data.range\r\n      this.myState.statusMessage = ''\r\n      this.timeFilter = [this.timeRange[0], this.timeRange[0] + 59]\r\n\r\n      if (this.gzipWorker) this.gzipWorker.terminate()\r\n\r\n      this.setColors()\r\n      this.moveLogo()\r\n      // this.eventLayers = [...this.eventLayers]\r\n\r\n      console.log('ALL DONE', {\r\n        totalRows,\r\n        data: data.range,\r\n        time: this.timeRange,\r\n        layers: this.eventLayers.length,\r\n      })\r\n    },\r\n\r\n    toggleAnimation() {\r\n      this.isAnimating = !this.isAnimating\r\n      if (this.isAnimating) {\r\n        this.animationElapsedTime = this.timeFilter[0] - this.timeRange[0]\r\n        this.startTime = Date.now() - this.animationElapsedTime / this.ANIMATE_SPEED\r\n        this.animate()\r\n      }\r\n    },\r\n\r\n    setColors() {\r\n      const EXPONENT = this.guiConfig.exponent // powerFunction // 4 // log-e? not steep enough\r\n\r\n      let colors256 = colormap({\r\n        colormap: this.guiConfig['color ramp'],\r\n        nshades: 256,\r\n        format: 'rba',\r\n        alpha: 1,\r\n      }).map((c: number[]) => [c[0], c[1], c[2]])\r\n\r\n      if (this.guiConfig.flip) colors256 = colors256.reverse()\r\n\r\n      const step = 256 / (this.guiConfig.buckets - 1)\r\n      const colors = []\r\n      for (let i = 0; i < this.guiConfig.buckets - 1; i++) {\r\n        colors.push(colors256[Math.round(step * i)])\r\n      }\r\n      colors.push(colors256[255])\r\n\r\n      // figure out min and max\r\n      const max1 = Math.pow(this.range[1], 1 / EXPONENT)\r\n      const max2 = (max1 * this.guiConfig['clip max']) / 100.0\r\n      // const clippedMin = (this.range[1] * this.clipData[0]) / 100.0\r\n\r\n      // console.log({ max1, max2 })\r\n\r\n      const breakpoints = [] as number[]\r\n      for (let i = 1; i < this.guiConfig.buckets; i++) {\r\n        const raw = (max2 * i) / this.guiConfig.buckets\r\n        const breakpoint = Math.pow(raw, EXPONENT)\r\n        breakpoints.push(breakpoint)\r\n      }\r\n\r\n      // only update legend if we have the full dataset already\r\n      if (this.isLoaded) this.setLegend(colors, breakpoints)\r\n\r\n      this.colors = colors\r\n      this.breakpoints = breakpoints\r\n    },\r\n\r\n    setLegend(colors: any[], breakpoints: number[]) {\r\n      // hide the legend if there is no data to show.\r\n      if (this.range[1] - this.range[0] === 0) return\r\n\r\n      this.legendStore = new LegendStore()\r\n      this.legendStore.setLegendSection({\r\n        section: 'Legend',\r\n        column: 'Legend',\r\n        values: colors.map((rgb, index) => {\r\n          const breakpoint = breakpoints[index == 0 ? index : index - 1]\r\n          let label = '' + Math.round(1e6 * breakpoint) / 1e6\r\n          if (index == 0) label = '< ' + label\r\n          if (index == colors.length - 1) label = '> ' + label\r\n          return { label, value: rgb }\r\n        }),\r\n      })\r\n    },\r\n\r\n    async loadNetwork() {\r\n      if (!this.myDataManager) throw Error('event viewer: no datamanager')\r\n\r\n      let networkFilename = this.vizDetails.file.replace('events.xml', 'network.xml')\r\n      const network = await this.myDataManager.getRoadNetwork(\r\n        networkFilename,\r\n        this.myState.subfolder,\r\n        Object.assign({ projection: '25833' }, this.vizDetails)\r\n      )\r\n\r\n      const linkIdLookup = {} as any\r\n      let i = 0\r\n      for (const link of network.linkIds) {\r\n        linkIdLookup[`${link}`] = i\r\n        i++\r\n      }\r\n\r\n      return { network, linkIdLookup }\r\n    },\r\n\r\n    async loadFiles() {\r\n      const { network, linkIdLookup } = await this.loadNetwork()\r\n      this.network = network\r\n      this.linkIdLookup = linkIdLookup\r\n\r\n      let dataArray: any = []\r\n      if (!this.fileApi) return { dataArray }\r\n\r\n      try {\r\n        let filename = `${this.myState.subfolder}/${this.vizDetails.file}`\r\n        await this.streamEventFile(filename)\r\n      } catch (e) {\r\n        console.error(e)\r\n        this.myState.statusMessage = '' + e\r\n        this.$store.commit('setStatus', {\r\n          type: Status.ERROR,\r\n          msg: `Loading/Parsing Error`,\r\n          desc: 'Error loading/parsing: ${this.myState.subfolder}/${this.vizDetails.file}',\r\n        })\r\n      }\r\n    },\r\n\r\n    animate() {\r\n      if (!this.isAnimating) return\r\n\r\n      this.animationElapsedTime = this.ANIMATE_SPEED * (Date.now() - this.startTime)\r\n\r\n      this.animationClockTime = this.animationElapsedTime + this.timeRange[0]\r\n\r\n      if (this.animationClockTime > this.timeRange[1]) {\r\n        this.startTime = Date.now()\r\n        this.animationElapsedTime = 0 // this.timeRange[0]\r\n      }\r\n\r\n      const span = this.timeFilter[1] - this.timeFilter[0]\r\n      this.timeFilter = [this.animationClockTime, this.animationClockTime + span]\r\n\r\n      this.animator = window.requestAnimationFrame(this.animate)\r\n    },\r\n\r\n    convertSecondsToClockTimeMinutes(index: number) {\r\n      const h = Math.floor(index / 3600)\r\n      const m = Math.floor((index - h * 3600) / 60)\r\n      const s = index - h * 3600 - m * 60\r\n\r\n      const hms = { h: `${h}`, m: `${m}`.padStart(2, '0'), s: `${s}`.padStart(2, '0') }\r\n\r\n      return `${hms.h}:${hms.m}`\r\n    },\r\n  },\r\n\r\n  async mounted() {\r\n    this.$store.commit('setFullScreen', !this.thumbnail)\r\n    this.myState.thumbnail = this.thumbnail\r\n    this.myState.yamlConfig = this.yamlConfig || ''\r\n    this.myState.subfolder = this.subfolder\r\n\r\n    // DataManager might be passed in from the dashboard; or we might be\r\n    // in single-view mode, in which case we need to create one for ourselves\r\n    this.myDataManager = this.datamanager || new DashboardDataManager(this.root, this.subfolder)\r\n\r\n    await this.getVizDetails()\r\n    await this.buildThumbnail()\r\n\r\n    if (this.thumbnail) return\r\n\r\n    this.setupLogoMover()\r\n\r\n    // ----------------------------------------------------\r\n    // this.setupGui()\r\n    this.myState.statusMessage = `${this.$i18n.t('loading')}`\r\n\r\n    if (!this.isLoaded) await this.loadFiles()\r\n  },\r\n\r\n  beforeDestroy() {\r\n    // MUST erase the React view handle to prevent gigantic memory leak!\r\n    REACT_VIEW_HANDLES[this.viewId] = undefined\r\n    delete REACT_VIEW_HANDLES[this.viewId]\r\n\r\n    try {\r\n      if (this.gzipWorker) {\r\n        this.gzipWorker.postMessage({ terminate: true })\r\n        this.gzipWorker.terminate()\r\n      }\r\n      if (this.guiController) this.guiController.destroy()\r\n    } catch (e) {\r\n      console.warn(e)\r\n    }\r\n\r\n    if (this.animator) window.cancelAnimationFrame(this.animator)\r\n\r\n    this.$store.commit('setFullScreen', false)\r\n  },\r\n})\r\n\r\nexport default MyComponent\r\n</script>\r\n\r\n<style scoped lang=\"scss\">\r\n@import '@/styles.scss';\r\n\r\n.viz-plugin {\r\n  position: absolute;\r\n  top: 0;\r\n  bottom: 0;\r\n  left: 0;\r\n  right: 0;\r\n  display: flex;\r\n  flex-direction: column;\r\n  min-height: $thumbnailHeight;\r\n  background: var(--bgMapPanel);\r\n}\r\n\r\n.message {\r\n  z-index: 5;\r\n  position: absolute;\r\n  bottom: 0;\r\n  left: 0;\r\n  width: 100%;\r\n  display: flex;\r\n  flex-direction: row;\r\n  margin: auto auto 0 0;\r\n  background-color: var(--bgPanel);\r\n  padding: 0rem 0.5rem;\r\n  border-radius: 0;\r\n\r\n  a {\r\n    color: white;\r\n    text-decoration: none;\r\n\r\n    &.router-link-exact-active {\r\n      color: white;\r\n    }\r\n  }\r\n\r\n  p {\r\n    color: var(--textFancy);\r\n    font-size: 1.2rem;\r\n    font-weight: normal;\r\n    line-height: 1.75rem;\r\n    margin: auto 0.5rem auto 0;\r\n    padding: 0 0;\r\n  }\r\n}\r\n\r\n.map-layer {\r\n  pointer-events: auto;\r\n}\r\n\r\n.drawing-tool {\r\n  position: absolute;\r\n  top: 0;\r\n  right: 0;\r\n  pointer-events: none;\r\n}\r\n\r\n.bottom-right {\r\n  position: absolute;\r\n  bottom: 0;\r\n  right: 0;\r\n  margin: auto 7px 15rem auto;\r\n  box-shadow: 0px 0px 5px 3px rgba(128, 128, 128, 0.1);\r\n}\r\n\r\n.legend-area {\r\n  background-color: var(--bgPanel);\r\n  border: 1px solid var(--bgPanel2);\r\n}\r\n\r\n.time-slider-area {\r\n  position: absolute;\r\n  bottom: 2.5rem;\r\n  left: 0;\r\n  right: 0;\r\n  margin: 0 8rem 0 0.5rem;\r\n  filter: $filterShadow;\r\n}\r\n\r\n.buckets {\r\n  color: var(--text);\r\n  padding: 4px 4px 4px 4px;\r\n  display: flex;\r\n}\r\n\r\n.ramp-selector {\r\n  background-color: var(--bgBold);\r\n}\r\n\r\n.configurator {\r\n  user-select: none;\r\n  background-color: var(--bgPanel);\r\n  margin-top: 2rem;\r\n}\r\n\r\n.clip-slider {\r\n  margin: 0 0.5rem;\r\n}\r\n\r\n.top-right {\r\n  background-color: var(--bgPanel2);\r\n  color: white;\r\n  position: absolute;\r\n  top: 0;\r\n  right: 0;\r\n  z-index: 5;\r\n  border-left: 1px solid #66669940;\r\n  border-bottom: 1px solid #66669940;\r\n  box-shadow: 0px 0px 5px 3px rgba(128, 128, 128, 0.1);\r\n}\r\n\r\n* > .number {\r\n  background-color: yellow;\r\n}\r\n\r\n@media only screen and (max-width: 640px) {\r\n  .message {\r\n    padding: 0.5rem 0.5rem;\r\n  }\r\n}\r\n</style>\r\n","\r\n.viz-plugin(oncontextmenu=\"return false\" :id=\"`id-${viewId}`\")\r\n\r\n  event-map.map-layer(v-if=\"!thumbnail && isLoaded\"\r\n    :viewId=\"viewId\"\r\n    :eventLayers=\"eventLayers\"\r\n    :network=\"network\"\r\n    :linkIdLookup=\"linkIdLookup\"\r\n    :timeFilter=\"timeFilter\"\r\n    :dark=\"this.$store.state.isDarkMode\"\r\n    :colors=\"this.colors\"\r\n    :breakpoints=\"this.breakpoints\"\r\n    :radius=\"this.guiConfig.radius\"\r\n    :mapIsIndependent=\"false\"\r\n    :simulationTime=\"timeFilter[1]\"\r\n  )\r\n\r\n  zoom-buttons(v-if=\"!thumbnail\" corner=\"bottom\")\r\n\r\n  .top-right\r\n    .gui-config(:id=\"configId\")\r\n\r\n  .bottom-right\r\n    .legend-area(v-if=\"legendStore\")\r\n      legend-box(:legendStore=\"legendStore\")\r\n\r\n  time-slider.time-slider-area(v-if=\"isLoaded\"\r\n    :range=\"timeRange\"\r\n    :activeTimeExtent=\"timeFilter\"\r\n    :labels=\"timeLabels\"\r\n    :isAnimating=\"isAnimating\"\r\n    @timeExtent=\"handleTimeSliderValues\"\r\n    @toggleAnimation=\"toggleAnimation\"\r\n    @drag=\"isAnimating=false\"\r\n  )\r\n\r\n  .message(v-if=\"!thumbnail && myState.statusMessage\")\r\n    p.status-message {{ myState.statusMessage }}\r\n\r\n"],"names":["BASE_URL","import","ICON_MAPPING","marker","x","y","width","height","mask","info","vehicle","diamond","dataFilter","DataFilterExtension","filterSize","INITIAL_VIEW","pitch","zoom","bearing","longitude","latitude","Component","viewId","eventLayers","network","linkIdLookup","timeFilter","dark","colors","breakpoints","radius","mapIsIndependent","simulationTime","viewState","setViewState","useState","REACT_VIEW_HANDLES","globalStore","state","handleViewState","view","center","commit","getTooltip","element","index","pointLayers","map","layer","layerIndex","outOfRange","times","length","ScatterplotLayer","data","attributes","getFilterValue","value","size","getPosition","positions","autoHighlight","extensions","id","filled","filterRange","getRadius","getFillColor","highlightColor","opacity","parameters","depthTest","pickable","radiusScale","stroked","updateTriggers","visible","vehicleLayers","vehicles","t0","t1","MovingIconsLayer","getTimeStart","getTimeEnd","getPathStart","locO","getPathEnd","locD","getColor","iconMoving","iconStill","getSize","currentTime","shadowEnabled","iconAtlas","iconMapping","sizeScale","billboard","allLayers","React","createElement","DeckGL","layers","controller","useDevicePixels","onViewStateChange","e","pickingRadius","onClick","StaticMap","mapStyle","getters","preventStyleDiffing","mapboxApiAccessToken","MAPBOX_TOKEN","i18n","MyComponent","defineComponent","CollapsiblePanel","DrawingTool","EventMap","LegendBox","TimeSlider","ZoomButtons","colorRamps","HTTPFileSystem","svnProject","a","timeValues","deckmap","logo","right","GUI","text","YAML","projection","filename","Status","hasYaml","configuration","key","buffer","base64","util","totalRows","MATSimEventStreamer","formatter","event","message","events","linkEvents","row","i","offset","numTrips","tripData","trip","coordinates","rows","EXPONENT","colors256","colormap","c","step","max2","raw","breakpoint","LegendStore","rgb","label","networkFilename","link","dataArray","span","h","m","s","hms","DashboardDataManager","render","_vm","_h","_c","$event","staticRenderFns"],"mappings":"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"}