import{d as o,g as n,n as c}from"./index.1d7144b8.js";function h(){return new Worker("/assets/TopSheetWorker.worker.ce1683f5.js",{type:"module"})}var d=o({name:"TopSheet",props:{fileSystemConfig:{type:Object,required:!0},subfolder:{type:String,required:!0},files:{type:Array,required:!0},yaml:{type:String,required:!0},allConfigFiles:{type:Object,required:!0},cardId:String},data:()=>({globalState:n.state,solverThread:null,table:[],entries:[],title:""}),mounted(){this.files.length&&this.runTopSheet()},beforeDestroy(){try{this.solverThread&&(this.solverThread.terminate(),this.solverThread=null)}catch(e){console.warn(e)}},watch:{"globalState.locale"(){this.solverThread&&this.solverThread.postMessage({command:"updateCalculations",entries:this.entries,locale:this.globalState.locale})}},methods:{formattedValue(e){return isNaN(e)?e===void 0?"-?-":e:e.toLocaleString([this.$store.state.locale,"en"])},async boxChanged(){console.log("changed!"),this.solverThread&&this.solverThread.postMessage({command:"updateCalculations",entries:this.entries,locale:this.globalState.locale})},async runTopSheet(){if(!!this.files.length)try{this.solverThread||(console.log("spawning topsheet thread"),this.solverThread=new h,this.solverThread.onmessage=e=>{this.processWorkerMessage(e)}),this.solverThread.postMessage({command:"runTopSheet",fileSystemConfig:this.fileSystemConfig,subfolder:this.subfolder,files:this.files,yaml:this.yaml,locale:this.$store.state.locale,allConfigFiles:this.allConfigFiles})}catch(e){const t=""+e;console.log(t),this.table=[]}},processWorkerMessage(e){const t=e.data;switch(t.response){case"title":this.cardId?this.$emit("titles",t.title):this.title=t.title;break;case"entries":this.entries=t.entryFields;break;case"results":this.table=t.results,this.$emit("isLoaded");break;case"error":this.$store.commit("error",`${this.yaml}: ${t.message}`),this.$emit("isLoaded");break;default:this.$emit("isLoaded"),console.error(t)}}}}),u=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"topsheet curate-content"},[e.title?s("h3",{staticClass:"curate-heading"},[e._v(" "+e._s(e.title))]):e._e(),e.entries.length?s("div",{staticClass:"output-table"},e._l(e.entries,function(l,a){return s("div",{key:"entry"+a,staticClass:"row"},[s("div",{staticClass:"cell top-label",style:l.style},[e._v(e._s(l.title))]),s("b-input",{staticClass:"b-input-tight cell top-value",style:l.style,on:{input:e.boxChanged},model:{value:l.value,callback:function(i){e.$set(l,"value",i)},expression:"row.value"}})],1)}),0):e._e(),e.table.length?s("div",{staticClass:"output-table",staticStyle:{"margin-top":"1rem"}},e._l(e.table,function(l,a){return s("div",{key:"row"+a,staticClass:"row"},[s("div",{staticClass:"cell top-label",style:l.style},[e._v(e._s(l.title))]),s("div",{staticClass:"cell top-value",style:l.style},[e._v(e._s(e.formattedValue(l.value)))])])}),0):e._e()])},p=[];const r={};var f=c(d,u,p,!1,v,"5c6e7936",null,null);function v(e){for(let t in r)this[t]=r[t]}var g=function(){return f.exports}();export{g as T};
//# sourceMappingURL=TopSheet.f44901df.js.map
