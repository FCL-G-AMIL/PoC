import{V as v,n as a,d as p,g as u}from"./index.1d7144b8.js";import{d as _}from"./index.39efad9c.js";import{H as b}from"./HTTPFileSystem.33aea9ff.js";import{W as g}from"./NewXmlFetcher.worker.f84d66d6.js";var x=v.component("tree-item",{props:{item:{type:Object,required:!0},expandAll:{type:Boolean},level:{type:Number},numberOfUnfoldLevel:{type:Number}},data(){return{isOpen:this.expandAll,text:"",elementId:"",children:[],attributes:[]}},mounted(){const e={...this.item};this.attributes=this.getAttributes(e),delete e[":@"];const t=Object.keys(e);t.length!==1&&console.log("WHAT",t),this.elementId=t[0],this.children=e[t[0]]||[],this.children.length===1&&this.children[0]["#text"]&&(this.text=this.children[0]["#text"],this.children=[]),this.level<this.numberOfUnfoldLevel+1?this.isOpen=!0:this.isOpen=this.expandAll},methods:{getAttributes(e){const t=e[":@"];return t?Object.entries(t).map(i=>{const[s,n]=i;return[s.startsWith("$$")?s.substring(2):s,n]}):[]},toggle(){this.isOpen=!this.isOpen}},computed:{isFolder(){return this.children.length>0}}}),y=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("li",[i("div",{staticClass:"leaf-node",on:{click:e.toggle}},[i("div",{staticClass:"leaf-nav-title"},[e.children.length?i("div",{staticClass:"toggle"},[i("i",{staticClass:"fa",class:{"fa-plus-square":!e.isOpen,"fa-minus-square":e.isOpen},staticStyle:{"font-size":"0.7rem",margin:"5px 0 auto -8px"}})]):e._e(),i("b",{staticClass:"leaf-label"},[e._v(e._s(e.elementId))])]),e.text?i("div",{staticClass:"leaf-text"},[e._v("\xA0\xA0"+e._s(e.text))]):e._e(),e._l(e.attributes,function(s){return i("div",{staticClass:"leaf-attribute"},[i("span",[e._v("\xA0\xA0"+e._s(s[0])+":\xA0")]),i("b",[e._v('"'+e._s(s[1])+'"')])])})],2),e.isFolder&&e.isOpen?i("ul",{staticClass:"children"},e._l(e.children,function(s,n){return i("tree-item",{key:n,staticClass:"item",attrs:{item:s,root:!1,expandAll:e.expandAll,numberOfUnfoldLevel:e.numberOfUnfoldLevel,level:e.level+1},on:{navigate:function(r){return e.$emit("navigate",r)}}})}),1):e._e()])},L=[];const f={};var O=a(x,y,L,!1,w,"2d8c488c",null,null);function w(e){for(let t in f)this[t]=f[t]}var $=function(){return O.exports}(),S=v.component("tree-view",{props:{initialData:{},expandAll:{type:Boolean},level:{type:Number},numberOfUnfoldLevel:{type:Number}},components:{TreeItem:$},data:function(){return{treeData:this.initialData}},methods:{}}),C=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("ul",[i("tree-item",{staticClass:"item",attrs:{item:e.treeData||{},expandAll:e.expandAll,level:e.level+1,numberOfUnfoldLevel:e.numberOfUnfoldLevel}})],1)},T=[];const m={};var k=a(S,C,T,!1,D,null,null,null);function D(e){for(let t in m)this[t]=m[t]}var X=function(){return k.exports}();const z={messages:{en:{},de:{}}},A=!!window.showDirectoryPicker,j=!A,W=p({name:"XmlViewer",components:{TreeView:X},i18n:z,props:{root:{type:String,required:!0},subfolder:{type:String,required:!0},config:{type:Object},resize:Object,thumbnail:Boolean,yamlConfig:String},data(){return{globalState:u.state,vizDetails:{title:"",description:"",file:""},loadingText:"",id:`id-${Math.floor(1e12*Math.random())}`,xmlWorker:null,viewXml:{},fullXml:null,searchXml:null,searchTerm:"",debounceSearch:{},isLoaded:!1,isSearch:!1,numberOfUnfoldLevel:1}},watch:{searchTerm(){this.debounceSearch()}},computed:{fileApi(){return new b(this.fileSystem,u)},fileSystem(){const e=this.$store.state.svnProjects.filter(t=>t.slug===this.root);if(e.length===0)throw console.log("no such project"),Error;return e[0]}},async mounted(){this.debounceSearch=_(this.handleSearch,500);try{if(await this.getVizDetails(),this.thumbnail)return;const e=await this.fetchXml();this.fullXml=e[1],this.viewXml=this.fullXml,this.isLoaded=!0}catch(e){const t=e;console.error({e:t}),this.loadingText=""+t}this.numberOfUnfoldLevel=this.config.unfoldLevel+1},methods:{async getVizDetails(){var e;if(this.config)this.vizDetails={...this.config},this.vizDetails.file=`/${this.subfolder}/${this.config.file}`,this.$emit("title",this.vizDetails.title||this.vizDetails.file||"XML");else{const t=(e=this.yamlConfig)!=null?e:"";this.vizDetails={title:t,description:"",file:this.subfolder+"/"+t}}this.vizDetails.title||(this.vizDetails.title="XML"),this.$emit("title",this.vizDetails.title)},async fetchXml(){return this.loadingText=`Loading ${this.vizDetails.file}...`,this.xmlWorker&&this.xmlWorker.terminate(),this.xmlWorker=new g,new Promise((e,t)=>{this.xmlWorker.onmessage=i=>{this.xmlWorker.terminate(),i.data.error&&t(i.data.error),e(i.data.xml)},this.xmlWorker.postMessage({id:1,fileSystem:this.fileSystem,filePath:this.vizDetails.file,options:{ignoreAttributes:!1,preserveOrder:!0,attributeNamePrefix:"$$",isFirefox:j}})})},async handleSearch(){if(console.log("search:",this.searchTerm),!this.searchTerm)this.viewXml=this.fullXml,this.isSearch=!1;else{const e=this.findSearchTermInElement([this.fullXml],this.searchTerm.toLocaleLowerCase());this.viewXml=e[0],this.isSearch=!0}this.isLoaded=!1,await this.$nextTick(),this.isLoaded=!0},findSearchTermInElement(e,t){if(t!==this.searchTerm.toLocaleLowerCase())return[];const i=[];for(const s of e){const n={...s};if(n[":@"]&&JSON.stringify(n[":@"]).toLocaleLowerCase().indexOf(t)>-1){i.push(s);continue}if(n["#text"]){`${n["#text"]}`.toLocaleLowerCase().indexOf(t)>-1&&i.push(s);continue}const r=n[":@"];delete n[":@"];const o=Object.keys(n)[0],c=n[o];if(!c.length)continue;const h=this.findSearchTermInElement(c,t);if(h.length){const l={};r&&(l[":@"]=r),l[o]=h,i.push(l)}}return i}}});var U=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"mycomponent",class:{"is-thumbnail":e.thumbnail}},[i("b-input",{staticClass:"searchbox",attrs:{type:"search","icon-pack":"fas",icon:"search",placeholder:"search..."},model:{value:e.searchTerm,callback:function(s){e.searchTerm=s},expression:"searchTerm"}}),i("div",{staticClass:"viewer"},[e.isLoaded?i("tree-view",{staticClass:"things",attrs:{initialData:e.viewXml,expandAll:e.isSearch,level:1,numberOfUnfoldLevel:e.numberOfUnfoldLevel}}):e._e()],1)],1)},M=[];const d={};var I=a(W,U,M,!1,V,"ca333fdc",null,null);function V(e){for(let t in d)this[t]=d[t]}var q=function(){return I.exports}();export{q as default};
//# sourceMappingURL=XmlViewer.03f9eae7.js.map
